<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Walkthrough for the CLVTools Package • CLVTools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Walkthrough for the CLVTools Package">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-31477052-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-31477052-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CLVTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.11.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/CLVTools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/internal_docu/internal_docu.html">Internal Package Documentation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bachmannpatrick/CLVTools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Walkthrough for the CLVTools Package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bachmannpatrick/CLVTools/blob/master/vignettes/CLVTools.Rmd" class="external-link"><code>vignettes/CLVTools.Rmd</code></a></small>
      <div class="hidden name"><code>CLVTools.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="prerequisites-setup-the-r-environment">Prerequisites: Setup the R environment<a class="anchor" aria-label="anchor" href="#prerequisites-setup-the-r-environment"></a>
</h2>
<p>Install the stable version from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"CLVTools"</span><span class="op">)</span></span></code></pre></div>
<p>Install the development version from GitHub (using the
<code>devtools</code> package <span class="citation">(Wickham, Hester,
and Chang 2019)</span>):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"bachmannpatrick/CLVTools"</span>, ref <span class="op">=</span> <span class="st">"development"</span><span class="op">)</span></span></code></pre></div>
<p>Load the package</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/bachmannpatrick/CLVTools" class="external-link">"CLVTools"</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="apply-the-clvtools-package">Apply the <code>CLVTools</code> Package<a class="anchor" aria-label="anchor" href="#apply-the-clvtools-package"></a>
</h2>
<div class="section level3">
<h3 id="general-workflow">General workflow<a class="anchor" aria-label="anchor" href="#general-workflow"></a>
</h3>
<p>Independent of the latent attrition model applied in
<code>CLVTools</code>, the general workflow consists of three main
steps:</p>
<ol style="list-style-type: decimal">
<li><p>Create a <code>clv.data</code> object containing the dataset and
required meta-information such as date formats and column names in the
dataset. After initializing the object, there is the option to add
additional information on covariates in a separate step.</p></li>
<li><p>Fit the model on the data provided.</p></li>
<li><p>Use the estimated model parameters to predict future customer
purchase behavior.</p></li>
</ol>
<div class="float">
<embed src="figures/WALKTHROUGH-steps.pdf"></embed><div class="figcaption">Workflow for <code>CLVTools</code>
</div>
</div>
<p><code>CLVTools</code> provides two ways for evaluating latent
attrition models: you can use of the provided formula interface or you
can use standard functions (non-formula interface). Both offer the same
functionality, however the formula interface is especially helpful when
covariates are included in the model. Through out this walkthrough, we
will illustrate both options.</p>
<p>Reporting and plotting results is facilitated by the implementation
of well-known generic methods such as <code><a href="../reference/plot.clv.fitted.transactions.html">plot()</a></code>,
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> and <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>. These commands adapt
their output according to the model state and may be used at any point
of the workﬂow.</p>
</div>
<div class="section level3">
<h3 id="load-sample-data-provided-in-the-package">Load sample data provided in the package<a class="anchor" aria-label="anchor" href="#load-sample-data-provided-in-the-package"></a>
</h3>
<p>As Input data <code>CLVTools</code> requires customers’ transaction
history. Every transaction record consists of a purchase date and
customer ID. Optionally, the price of the transaction may be included to
allow for prediction of future customer spending using an additional
Gamma/Gamma model<span class="citation">(Fader, Hardie, and Lee 2005b;
Colombo and Jiang 1999)</span>. Using the full history of transaction
data allows for comprehensive plots and summary statistics, which allow
the identification of possible issues prior to model estimation. Data
may be provided as <code>data.frame</code> or <code>data.table</code>
<span class="citation">(Dowle and Srinivasan 2019)</span>.</p>
<p>It is common practice to split time series data into two parts, an
estimation and a holdout period. The model is estimated based on the
data from the estimation period while the data from the holdout period
allows to rigorously assess model performance. Once model performance is
checked on known data one can proceed to predict data without a holdout
period. The length of the estimation period is heavily dependent on the
characteristics of the analyzed dataset. We recommend to choose an
estimation period that contains in minimum the length of the average
inter-purchase time. Note that all customers in the dataset need to
purchase at least once during the estimation period, i.e. these models
do not account for prospects who have not yet a purchase record.</p>
<p>Some models included in <code>CLVTools</code> allow to model the
impact of covariates. These covariates may explain heterogeneity among
the customers and therefore increase the predictive accuracy of the
model. At the same time, we may also identify and quantify the effects
of these covariates on customer purchase and customer attrition.
<code>CLVTools</code> distinguishes between time-invariant and
time-varying covariates. Time-invariant covariates include customer
characteristics such as demographics that do not change over time.
Time-varying covariates are allowed to change over time. They include
for example direct marketing information or seasonal patterns.</p>
<p>For the following example, we use simulated data comparable to data
from a retailer in the apparel industry. The dataset contains
transactional detail records for every customer consisting of customer
id, date of purchase and the total monetary value of the transaction.
The apparel dataset is available in the <code>CLVTools</code> package.
Use the <code>data(apparelTrans)</code> to load it:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"apparelTrans"</span><span class="op">)</span></span>
<span><span class="va">apparelTrans</span></span>
<span><span class="co">#&gt;           Id       Date  Price</span></span>
<span><span class="co">#&gt;       &lt;char&gt;     &lt;Date&gt;  &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:      1 2005-01-02 230.30</span></span>
<span><span class="co">#&gt;    2:      1 2005-09-06  84.39</span></span>
<span><span class="co">#&gt;    3:      1 2006-01-18 131.07</span></span>
<span><span class="co">#&gt;    4:      1 2006-04-05  86.43</span></span>
<span><span class="co">#&gt;    5:      1 2006-07-02  11.49</span></span>
<span><span class="co">#&gt;   ---                         </span></span>
<span><span class="co">#&gt; 3183:    600 2005-01-02  24.94</span></span>
<span><span class="co">#&gt; 3184:    600 2005-04-17  54.97</span></span>
<span><span class="co">#&gt; 3185:    600 2005-06-30  66.84</span></span>
<span><span class="co">#&gt; 3186:    600 2005-10-27  22.54</span></span>
<span><span class="co">#&gt; 3187:    600 2006-01-09  12.97</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="clvdata">Initialize the CLV-Object<a class="anchor" aria-label="anchor" href="#clvdata"></a>
</h3>
<p>Before we estimate a model, we are required to initialize a data
object using the <code><a href="../reference/clvdata.html">clvdata()</a></code> command. The data object
contains the prepared transactional data and is later used as input for
model fitting. Make sure to store the generated object in a variable,
e.g. in our example <code>clv.apparel</code>.</p>
<p>Be aware that probabilistic models such as the ones implemented in
<code>CLVTools</code> are usually applied to specific customer cohorts.
That means, you analyze customer that have joined your company at the
same time (usually same day, week, month, or quarter). For more
information on cohort analysis, see also <a href="https://en.wikipedia.org/wiki/Cohort_analysis" class="external-link">here</a>.
Consequently, the data apparelTrans in this example is not the full
transaction records of a fashion retailer, but rather only the customer
cohort of 250 customers purchasing for the first time at this business
on the day of 2005-01-03. This has to be done before initializing a data
object using the <code><a href="../reference/clvdata.html">clvdata()</a></code> command.</p>
<p>Through the argument <code>data.transactions</code> a
<code>data.frame</code> or <code>data.table</code> which contains the
transaction records, is specified. In our example this is
<code>data.transactions=apparelTrans</code>. The argument
<code>date.format</code> is used to indicate the format of the date
variable in the data used. The date format in the apparel dataset is
given as “year-month-day” (i.e., “2005-01-03”), therefore we set
<code>date.format="ymd"</code>. Other combinations such as
<code>date.format="dmy"</code> are possible. See the documentation of
<code>lubridate</code> <span class="citation">(Grolemund and Wickham
2011)</span> for all details. <code>time.unit</code> is the scale used
to measure time between two dates. For this dataset and in most other
cases The argument <code>time.unit="week"</code> is the preferred
choice. Abbreviations may be used (i.e. “w”).
<code>estimation.split</code> indicates the length of the estimation
period. Either the length of the estimation period (in previous
specified time units) or the date at which the estimation period ends
can be specified. If no value is provided, the whole dataset is used as
estimation period (i.e. no holdout period). In this example, we use an
estimation period of 40 weeks. Finally, the three name arguments
indicate the column names for customer ID, date and price in the
supplied dataset. Note that the price column is optional.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clv.apparel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clvdata.html">clvdata</a></span><span class="op">(</span><span class="va">apparelTrans</span>,  </span>
<span>                       date.format<span class="op">=</span><span class="st">"ymd"</span>, </span>
<span>                       time.unit <span class="op">=</span> <span class="st">"week"</span>,</span>
<span>                       estimation.split <span class="op">=</span> <span class="fl">104</span>,</span>
<span>                       name.id <span class="op">=</span> <span class="st">"Id"</span>,</span>
<span>                       name.date <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>                       name.price <span class="op">=</span> <span class="st">"Price"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-the-clvdata-object">Check the <code>clvdata</code> Object<a class="anchor" aria-label="anchor" href="#check-the-clvdata-object"></a>
</h3>
<p>To get details on the <code>clvdata</code> object, print it to the
console.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clv.apparel</span></span>
<span><span class="co">#&gt; CLV Transaction Data </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; clvdata(data.transactions = apparelTrans, date.format = "ymd", </span></span>
<span><span class="co">#&gt;     time.unit = "week", estimation.split = 104, name.id = "Id", </span></span>
<span><span class="co">#&gt;     name.date = "Date", name.price = "Price")</span></span>
<span><span class="co">#&gt;                          </span></span>
<span><span class="co">#&gt; Total # customers    600 </span></span>
<span><span class="co">#&gt; Total # transactions 3183</span></span>
<span><span class="co">#&gt; Spending information TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                 </span></span>
<span><span class="co">#&gt; Time unit         Weeks         </span></span>
<span><span class="co">#&gt;                                 </span></span>
<span><span class="co">#&gt; Estimation start  2005-01-02    </span></span>
<span><span class="co">#&gt; Estimation end    2006-12-31    </span></span>
<span><span class="co">#&gt; Estimation length 104.0000 Weeks</span></span>
<span><span class="co">#&gt;                                 </span></span>
<span><span class="co">#&gt; Holdout start     2007-01-01    </span></span>
<span><span class="co">#&gt; Holdout end       2010-12-20    </span></span>
<span><span class="co">#&gt; Holdout length    207.0000 Weeks</span></span></code></pre></div>
<p>Alternatively the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> command provides full
detailed summary statistics for the provided transactional detail.
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> is available at any step in the process of
estimating a probabilistic customer attrition model with
<code>CLVTools</code>. The result output is updated accordingly and
additional information is added to the summary
statistics.<code><a href="https://rdrr.io/r/stats/nobs.html" class="external-link">nobs()</a></code> extracts the number of observations. For
the this particular dataset we observe a total of 250 customers who made
in total 2257 repeat purchases. Approximately 26% of the customers are
zero repeaters, which means that the only a minority of the customers do
not return to the store after their first purchase.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">clv.apparel</span><span class="op">)</span></span>
<span><span class="co">#&gt; CLV Transaction Data </span></span>
<span><span class="co">#&gt;                                 </span></span>
<span><span class="co">#&gt; Time unit         Weeks         </span></span>
<span><span class="co">#&gt; Estimation length 104.0000 Weeks</span></span>
<span><span class="co">#&gt; Holdout length    207.0000 Weeks</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Transaction Data Summary </span></span>
<span><span class="co">#&gt;                                    Estimation      Holdout         Total     </span></span>
<span><span class="co">#&gt; Number of customers                -               -               600       </span></span>
<span><span class="co">#&gt; First Transaction in period        2005-01-02      2007-01-01      2005-01-02</span></span>
<span><span class="co">#&gt; Last Transaction in period         2006-12-31      2010-12-20      2010-12-20</span></span>
<span><span class="co">#&gt; Total # Transactions               1866            1317            3183      </span></span>
<span><span class="co">#&gt; Mean # Transactions per cust       3.110           5.557           5.305     </span></span>
<span><span class="co">#&gt; (SD)                               2.714           5.123           6.119     </span></span>
<span><span class="co">#&gt; Mean Spending per Transaction      40.545          36.977          39.069    </span></span>
<span><span class="co">#&gt; (SD)                               73.362          55.356          66.519    </span></span>
<span><span class="co">#&gt; Total Spending                     75657.730       48699.170       124356.900</span></span>
<span><span class="co">#&gt; Total # zero repeaters             213             -               -         </span></span>
<span><span class="co">#&gt; Percentage of zero repeaters       35.500          -               -         </span></span>
<span><span class="co">#&gt; Mean Interpurchase time            24.823          30.604          37.817    </span></span>
<span><span class="co">#&gt; (SD)                               19.417          24.756          42.339</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimate">Estimate Model Parameters<a class="anchor" aria-label="anchor" href="#estimate"></a>
</h3>
<p>After initializing the object, we can start estimating the first
probabilistic latent attrition model. We start with the standard
Pareto/NBD model <span class="citation">(Schmittlein, Morrison, and
Colombo 1987)</span> and therefore use the command <code><a href="../reference/pnbd.html">pnbd()</a></code>
to fit the model and estimate model parameters. <code>clv.data</code>
specifies the initialized object prepared in the last step. Optionally,
starting values for the model parameters and control settings for the
optimization algorithm may be provided: The argument
<code>start.params.model</code> allows to assign a vector
(e.g. <code>c(alpha=1, beta=2, s=1, beta=2)</code> in the case of the
Pareto/NBD model) of starting values for the optimization. This is
useful if prior knowledge on the parameters of the distributions are
available. By default starting values are set to 1 for all parameters.
The argument <code>optimx.args</code> provides an option to control
settings for the optimization routine. It passes a list of arguments to
the optimizer. All options known from the package <code>optimx</code>
<span class="citation">(Nash and Varadhan 2011; Nash 2014)</span> may be
used. This option enables users to specify specific optimization
algorithms, set upper and/or lower limits or enable tracing information
on the progress of the optimization. In the case of the standard
Pareto/NBD model, <code>CLVTools</code> uses by default the optimization
method <code>L-BFGS-G</code> <span class="citation">(Byrd et al.
1995)</span>. If the result of the optimization is in-feasible, the
optimization automatically switches to the more robust but often slower
<code>Nelder-Mead</code> method <span class="citation">(Nelder and Mead
1965)</span>. <code>verbose</code> shows additional output.</p>
<p>To execute the model estimation you have the choice between a
formula-based interface and a non-formula-based interface. In the
following we illustrate the two alternatives.</p>
<div class="section level4">
<h4 id="estimating-the-model-using-formula-interface">
<strong>Estimating the model using formula interface:</strong><a class="anchor" aria-label="anchor" href="#estimating-the-model-using-formula-interface"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>   <span class="va">est.pnbd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latentAttrition.html">latentAttrition</a></span><span class="op">(</span>formula <span class="op">=</span> , family <span class="op">=</span> <span class="va">pnbd</span>, data<span class="op">=</span><span class="va">clv.apparel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting estimation...</span></span>
<span><span class="co">#&gt; Estimation finished!</span></span>
<span>   <span class="va">est.pnbd</span></span>
<span><span class="co">#&gt; Pareto/NBD Standard Model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; latentAttrition(family = pnbd, data = clv.apparel)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;       r    alpha        s     beta  </span></span>
<span><span class="co">#&gt;  1.4490  48.6361   0.5613  46.8844  </span></span>
<span><span class="co">#&gt; KKT1: TRUE </span></span>
<span><span class="co">#&gt; KKT2: TRUE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Used Options:</span></span>
<span><span class="co">#&gt; Correlation:     FALSE</span></span></code></pre></div>
<pre><code>Using start parameters and other additional arguments for the optimzier:</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">est.pnbd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latentAttrition.html">latentAttrition</a></span><span class="op">(</span>formula <span class="op">=</span> , family <span class="op">=</span> <span class="va">pnbd</span>, data<span class="op">=</span><span class="va">clv.apparel</span>, </span>
<span>                              optimx.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>                                       method<span class="op">=</span><span class="st">"Nelder-Mead"</span><span class="op">)</span>, </span>
<span>                              start.params.model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>r<span class="op">=</span><span class="fl">1</span>, alpha<span class="op">=</span><span class="fl">10</span>, s<span class="op">=</span><span class="fl">2</span>, beta<span class="op">=</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="estimating-the-model-using-non-formula-interface">
<strong>Estimating the model using non-formula
interface:</strong><a class="anchor" aria-label="anchor" href="#estimating-the-model-using-non-formula-interface"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">est.pnbd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span><span class="op">(</span>clv.data <span class="op">=</span> <span class="va">clv.apparel</span><span class="op">)</span></span>
<span>    <span class="va">est.pnbd</span></span></code></pre></div>
<pre><code>If we assign starting parameters and additional arguments for the optimizer we use: </code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>   <span class="va">est.pnbd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span><span class="op">(</span>clv.data <span class="op">=</span> <span class="va">clv.apparel</span>, </span>
<span>                    start.params.model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>r<span class="op">=</span><span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">2</span>, s <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>                    optimx.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>                                       method<span class="op">=</span><span class="st">"Nelder-Mead"</span> </span>
<span>                                       <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Parameter estimates may be reported by either printing the estimated
object (i.e. <code>est.pnbd</code>) directly in the console or by
calling <code>summary(est.pnbd)</code> to get a more detailed report
including the likelihood value as well as AIC and BIC. Alternatively
parameters may be directly extracted using <code>coef(est.pnbd)</code>.
Also <code>loglik()</code>, <code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code> and
<code><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov()</a></code> are available to directly access the Loglikelihood
value, confidence intervals for the parameters and to calculate the
Variance-Covariance Matrix for the fitted model. For the standard
Pareto/NBD model, we get 4 parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>,</mo><mi>α</mi><mo>,</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">r, \alpha, s</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>.
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>,</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">r,\alpha</annotation></semantics></math>
represent the shape and scale parameter of the gamma distribution that
determines the purchase rate and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>,</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">s,\beta</annotation></semantics></math>
of the attrition rate across individual customers.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>/</mi><mi>α</mi></mrow><annotation encoding="application/x-tex">r/\alpha</annotation></semantics></math>
can be interpreted as the mean purchase and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>/</mi><mi>β</mi></mrow><annotation encoding="application/x-tex">s/\beta</annotation></semantics></math>
as the mean attrition rate. A significance level is provided for each
parameter estimates. In the case of the apparelTrans dataset we observe
a an average purchase rate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>/</mi><mi>α</mi><mo>=</mo><mn>0.147</mn></mrow><annotation encoding="application/x-tex">r/\alpha=0.147</annotation></semantics></math>
transactions and an average attrition rate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>/</mi><mi>β</mi><mo>=</mo><mn>0.031</mn></mrow><annotation encoding="application/x-tex">s/\beta=0.031</annotation></semantics></math>
per customer per week. KKT 1 and 2 indicate the Karush-Kuhn-Tucker
optimality conditions of the first and second order <span class="citation">(Kuhn and Tucker 1951)</span>. If those criteria are
not met, the optimizer has probably not arrived at an optimal solution.
If this is the case it is usually a good idea to rerun the estimation
using alternative starting values.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Full detailed summary of the parameter estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est.pnbd</span><span class="op">)</span></span>
<span><span class="co">#&gt; Pareto/NBD Standard  Model </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; latentAttrition(family = pnbd, data = clv.apparel)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fitting period:                                </span></span>
<span><span class="co">#&gt; Estimation start  2005-01-02    </span></span>
<span><span class="co">#&gt; Estimation end    2006-12-31    </span></span>
<span><span class="co">#&gt; Estimation length 104.0000 Weeks</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;       Estimate Std. Error z-val Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; r       1.4490     0.2434 5.952 2.64e-09 ***</span></span>
<span><span class="co">#&gt; alpha  48.6361     7.4892 6.494 8.35e-11 ***</span></span>
<span><span class="co">#&gt; s       0.5613     0.2710 2.071   0.0384 *  </span></span>
<span><span class="co">#&gt; beta   46.8844    35.6114 1.317   0.1880    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimization info:                 </span></span>
<span><span class="co">#&gt; LL     -5848.0978</span></span>
<span><span class="co">#&gt; AIC    11704.1957</span></span>
<span><span class="co">#&gt; BIC    11721.7834</span></span>
<span><span class="co">#&gt; KKT 1  TRUE      </span></span>
<span><span class="co">#&gt; KKT 2  TRUE      </span></span>
<span><span class="co">#&gt; fevals 25.0000   </span></span>
<span><span class="co">#&gt; Method L-BFGS-B  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Used Options:                 </span></span>
<span><span class="co">#&gt; Correlation FALSE</span></span>
<span></span>
<span><span class="co">#Extract the coefficients only</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">est.pnbd</span><span class="op">)</span></span>
<span><span class="co">#&gt;          r      alpha          s       beta </span></span>
<span><span class="co">#&gt;  1.4489768 48.6360846  0.5612598 46.8843632</span></span>
<span><span class="co">#Alternative: oefficients(est.pnbd.obj)</span></span></code></pre></div>
<p>To extract only the coefficients, we can use <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code>. To
access the confidence intervals for all parameters
<code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code> is available.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Extract the coefficients only</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">est.pnbd</span><span class="op">)</span></span>
<span><span class="co">#&gt;          r      alpha          s       beta </span></span>
<span><span class="co">#&gt;  1.4489768 48.6360846  0.5612598 46.8843632</span></span>
<span><span class="co">#Alternative: oefficients(est.pnbd.obj)</span></span>
<span></span>
<span><span class="co">#Extract the confidence intervals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">est.pnbd</span><span class="op">)</span></span>
<span><span class="co">#&gt;              2.5 %     97.5 %</span></span>
<span><span class="co">#&gt; r       0.97186638   1.926087</span></span>
<span><span class="co">#&gt; alpha  33.95755820  63.314611</span></span>
<span><span class="co">#&gt; s       0.03001565   1.092504</span></span>
<span><span class="co">#&gt; beta  -22.91271866 116.681445</span></span></code></pre></div>
<p>In order to get the Likelihood value and the corresponding
Variance-Covariance Matrix we use the following commands:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># LogLikelihood at maximum</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">est.pnbd</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' -5848.098 (df=4)</span></span>
<span></span>
<span><span class="co"># Variance-Covariance Matrix at maximum</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">est.pnbd</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 r       alpha           s        beta</span></span>
<span><span class="co">#&gt; r      0.05925727   1.7049763 -0.01786466   -3.472616</span></span>
<span><span class="co">#&gt; alpha  1.70497629  56.0878423 -0.43375970  -82.963755</span></span>
<span><span class="co">#&gt; s     -0.01786466  -0.4337597  0.07346697    9.366245</span></span>
<span><span class="co">#&gt; beta  -3.47261638 -82.9637547  9.36624462 1268.172554</span></span></code></pre></div>
<p>As an alternative to the Pareto/NBD model <code>CLVTools</code>
features the BG/NBD model <span class="citation">(Fader, Hardie, and Lee
2005a)</span> and the GGomp/NBD <span class="citation">(Bemmaor and
Glady 2012)</span>. To use the alternative models replace
<code><a href="../reference/pnbd.html">pnbd()</a></code> by the corresponding model-command. Note that he
naming and number of model parameters is dependent on the model. Consult
the manual for more details on the individual models. Beside
probabilistic latent attrition models, <code>CLVTools</code> also
features the Gamma/Gamma model <span class="citation">(Colombo and Jiang
1999; Fader, Hardie, and Lee 2005a)</span> which is used to predict
customer spending. See section <a href="#spending">Customer Spending</a>
for details on the spending model.</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>Command</th>
<th>Model</th>
<th>Covariates</th>
<th>Type</th>
<th></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>pnbd()</td>
<td>Pareto/NBD</td>
<td>time-invariant &amp; time-varying</td>
<td>latent attrition model</td>
<td></td>
</tr>
<tr class="even">
<td>bgnbd()</td>
<td>BG/NBD</td>
<td>time-invariant</td>
<td>latent attrition model</td>
<td></td>
</tr>
<tr class="odd">
<td>ggomnbd()</td>
<td>GGom/NBD</td>
<td>time-invariant</td>
<td>latent attrition model</td>
<td></td>
</tr>
<tr class="even">
<td>gg()</td>
<td>Gamma/Gamma</td>
<td>-</td>
<td>spending model</td>
<td></td>
</tr>
</tbody>
</table>
<p>To estimate the GGom/NBD model we apply the <code><a href="../reference/ggomnbd.html">ggomnbd()</a></code>to
the <code>clv.apparel</code> object. The GGom/NBD model is more flexible
than the Pareto/NBD model, however it sometimes is challenging to
optimize. Note that in this particular case providing start parameters
is essential to arrive at an optimal solution
(i.e. <code>kkt1: TRUE</code> and <code>kkt2: TRUE</code>).</p>
<p>To execute the model estimation you have the choice between a
formula-based interface and a non-formula-based interface. In the
following we illustrate the two alternatives.</p>
</div>
<div class="section level4">
<h4 id="estimating-the-model-using-formula-interface-1">
<strong>Estimating the model using formula interface:</strong><a class="anchor" aria-label="anchor" href="#estimating-the-model-using-formula-interface-1"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">est.ggomnbd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latentAttrition.html">latentAttrition</a></span><span class="op">(</span>formula <span class="op">=</span> , family <span class="op">=</span> <span class="va">ggomnbd</span>, data<span class="op">=</span><span class="va">clv.apparel</span>, </span>
<span>                                 optimx.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"Nelder-Mead"</span><span class="op">)</span>,</span>
<span>                                 start.params.model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>r<span class="op">=</span><span class="fl">0.7</span>, alpha<span class="op">=</span><span class="fl">5</span>, b<span class="op">=</span><span class="fl">0.005</span>,  s<span class="op">=</span><span class="fl">0.02</span>, beta<span class="op">=</span><span class="fl">0.001</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="estimating-the-model-using-non-formula-interface-1">
<strong>Estimating the model using non-formula
interface:</strong><a class="anchor" aria-label="anchor" href="#estimating-the-model-using-non-formula-interface-1"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.ggomnbd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggomnbd.html">ggomnbd</a></span><span class="op">(</span>clv.data <span class="op">=</span> <span class="va">clv.apparel</span>, </span>
<span>                       start.params.model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>r<span class="op">=</span><span class="fl">0.7</span>, alpha<span class="op">=</span><span class="fl">5</span>, b<span class="op">=</span><span class="fl">0.005</span>,  s<span class="op">=</span><span class="fl">0.02</span>, beta<span class="op">=</span><span class="fl">0.001</span><span class="op">)</span>, </span>
<span>                       optimx.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"Nelder-Mead"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="predict">Predict Customer Behavior<a class="anchor" aria-label="anchor" href="#predict"></a>
</h3>
<p>Once the model parameters are estimated, we are able to predict
future customer behavior on an individual level. To do so, we use
<code><a href="../reference/predict.clv.fitted.transactions.html">predict()</a></code> on the object with the estimated parameters
(i.e. <code>est.pnbd</code>). The prediction period may be varied by
specifying <code>prediction.end</code>. It is possible to provide either
an end-date or a duration using the same time unit as specified when
initializing the object (i.e <code>prediction.end = "2006-05-08"</code>
or <code>prediction.end = 30</code>). By default, the prediction is made
until the end of the dataset specified in the <code><a href="../reference/clvdata.html">clvdata()</a></code>
command. The argument <code>continuous.discount.factor</code> allows to
adjust the discount rate used to estimated the discounted expected
transactions (DERT). The default value is <code>0.1</code> (=10%). Make
sure to convert your discount rate if you use annual/monthly/weekly
discount rates. An annual rate of <code>(100 x d)\%</code> equals a
continuous rate <code>delta = ln(1+d)</code>. To account for time units
which are not annual, the continuous rate has to be further adjusted to
<code>delta=ln(1+d)/k</code>, where <code>k</code> are the number of
time units in a year. Probabilistic customer attrition model predict in
general three expected characteristics for every customer:</p>
<ul>
<li>“conditional expected transactions” (CET), which is the number of
transactions to expect form a customer during the prediction
period,</li>
<li>“probability of a customer being alive” (PAlive) at the end of the
estimation period and</li>
<li>“discounted expected residual transactions” (DERT) for every
customer, which is the total number of transactions for the residual
lifetime of a customer discounted to the end of the estimation
period.</li>
</ul>
<p>If spending information was provided when initializing the
<code>clvdata</code>-object, <code>CLVTools</code> provides prediction
for</p>
<ul>
<li>predicted mean spending estimated by a Gamma/Gamma model <span class="citation">(Colombo and Jiang 1999; Fader, Hardie, and Lee
2005a)</span> and</li>
<li>the customer lifetime value (CLV). CLV is calculated as the product
of DERT and predicted spending.</li>
</ul>
<p>If a holdout period is available additionally the true numbers of
transactions (“actual.x”) and true spending (“actual.total.spending”)
during the holdout period are reported.</p>
<p>To use the parameter estimates on new data (e.g., an other customer
cohort), the argument <code>newdata</code> optionally allows to provide
a new <code>clvdata</code> object.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict.clv.fitted.transactions.html">predict</a></span><span class="op">(</span><span class="va">est.pnbd</span><span class="op">)</span></span>
<span><span class="co">#&gt; Predicting from 2007-01-01 until (incl.) 2010-12-20 (207.14 Weeks).</span></span>
<span><span class="co">#&gt; Estimating gg model to predict spending...</span></span>
<span><span class="co">#&gt; Starting estimation...</span></span>
<span><span class="co">#&gt; Estimation finished!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;Id&gt;</span></span>
<span><span class="co">#&gt;          Id period.first period.last period.length actual.x</span></span>
<span><span class="co">#&gt;      &lt;char&gt;       &lt;Date&gt;      &lt;Date&gt;         &lt;num&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt;   1:      1   2007-01-01  2010-12-20      207.1429        0</span></span>
<span><span class="co">#&gt;   2:     10   2007-01-01  2010-12-20      207.1429        1</span></span>
<span><span class="co">#&gt;   3:    100   2007-01-01  2010-12-20      207.1429        9</span></span>
<span><span class="co">#&gt;   4:    101   2007-01-01  2010-12-20      207.1429        0</span></span>
<span><span class="co">#&gt;   5:    102   2007-01-01  2010-12-20      207.1429        0</span></span>
<span><span class="co">#&gt;  ---                                                       </span></span>
<span><span class="co">#&gt; 596:     95   2007-01-01  2010-12-20      207.1429        4</span></span>
<span><span class="co">#&gt; 597:     96   2007-01-01  2010-12-20      207.1429        3</span></span>
<span><span class="co">#&gt; 598:     97   2007-01-01  2010-12-20      207.1429        0</span></span>
<span><span class="co">#&gt; 599:     98   2007-01-01  2010-12-20      207.1429        0</span></span>
<span><span class="co">#&gt; 600:     99   2007-01-01  2010-12-20      207.1429        0</span></span>
<span><span class="co">#&gt;      actual.total.spending    PAlive       CET       DERT</span></span>
<span><span class="co">#&gt;                      &lt;num&gt;     &lt;num&gt;     &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:                  0.00 0.9468478 7.3256573 0.46765602</span></span>
<span><span class="co">#&gt;   2:                 14.37 0.9825606 3.5198114 0.22469806</span></span>
<span><span class="co">#&gt;   3:                333.35 0.2784686 0.4190901 0.02675392</span></span>
<span><span class="co">#&gt;   4:                  0.00 0.4739762 1.2056215 0.07696458</span></span>
<span><span class="co">#&gt;   5:                  0.00 0.2784686 0.4190901 0.02675392</span></span>
<span><span class="co">#&gt;  ---                                                     </span></span>
<span><span class="co">#&gt; 596:                 98.81 0.8978209 3.2162499 0.20531927</span></span>
<span><span class="co">#&gt; 597:                253.61 0.2784686 0.4190901 0.02675392</span></span>
<span><span class="co">#&gt; 598:                  0.00 0.2784686 0.4190901 0.02675392</span></span>
<span><span class="co">#&gt; 599:                  0.00 0.6024098 1.5323094 0.09781972</span></span>
<span><span class="co">#&gt; 600:                  0.00 0.9416701 4.3513967 0.27778489</span></span>
<span><span class="co">#&gt;      predicted.mean.spending predicted.total.spending predicted.CLV</span></span>
<span><span class="co">#&gt;                        &lt;num&gt;                    &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:                88.64634                649.39268     41.455992</span></span>
<span><span class="co">#&gt;   2:                41.21027                145.05238      9.259868</span></span>
<span><span class="co">#&gt;   3:                37.62791                 15.76949      1.006694</span></span>
<span><span class="co">#&gt;   4:                34.56278                 41.66962      2.660110</span></span>
<span><span class="co">#&gt;   5:                37.62791                 15.76949      1.006694</span></span>
<span><span class="co">#&gt;  ---                                                               </span></span>
<span><span class="co">#&gt; 596:                26.54863                 85.38701      5.450944</span></span>
<span><span class="co">#&gt; 597:                37.62791                 15.76949      1.006694</span></span>
<span><span class="co">#&gt; 598:                37.62791                 15.76949      1.006694</span></span>
<span><span class="co">#&gt; 599:                35.83393                 54.90868      3.505265</span></span>
<span><span class="co">#&gt; 600:                19.20941                 83.58774      5.336082</span></span></code></pre></div>
<p>To change the duration of the prediction time, we use the
<code>predicton.end</code> argument. We can either provide a time period
(30 weeks in this example):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict.clv.fitted.transactions.html">predict</a></span><span class="op">(</span><span class="va">est.pnbd</span>, prediction.end <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p>or provide a date indication the end of the prediction period:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predict.clv.fitted.transactions.html">predict</a></span><span class="op">(</span><span class="va">est.pnbd</span>, prediction.end <span class="op">=</span> <span class="st">"2006-05-08"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h3>
<p><code>CLVTools</code>, offers a variety of different plots. All
<code>clvdata</code> objects may be plotted using the
<code><a href="../reference/plot.clv.fitted.transactions.html">plot()</a></code> command. Similar to <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, the
output of <code><a href="../reference/plot.clv.fitted.transactions.html">plot()</a></code> and the corresponding options are
dependent on the current modeling step. When applied to a data object
created the <code><a href="../reference/clvdata.html">clvdata()</a></code> command, the following plots can be
selected using the <code>which</code> option of plotting:</p>
<ul>
<li>Tracking plot (<code>which="tracking"</code>): plots the the
aggregated repeat transactions per period over a given time period. The
period can be specified using the <code>prediction.end</code> option. It
is also possible to generate cumulative tracking plots
(<code>cumulative = FALSE</code>). The tracking plot is the default
option.</li>
<li>Frequency plot (<code>which="frequency"</code>): plots the
distribution of transactions or repeat transactions per customer, after
aggregating transactions of the same customer on a single time point.
The bins may be adjusted using the option <code>trans.bins</code>. (Note
that if <code>trans.bins</code> is changed, the option for labeling
(<code>label.remaining</code>) usually needs to be adapted as
well.)</li>
<li>Spending plot (<code>which="spending"</code>): plots the empirical
density of either customer’s average spending per transaction. Note that
this includes all transactions and not only repeat-transactions. You can
switch to plotting the value of every transaction for a customer
(instead of the a customers mean spending) using
<code>mean.spending=FALSE</code>.</li>
<li>Interpurchase time plot (<code>which="interpurchasetime"</code>):
plots the empirical density of customer’s mean time (in number of
periods) between transactions, after aggregating transactions of the
same customer on a single time point. Note that customers without
repeat-transactions are note part of this plot.</li>
</ul>
<p>In the following, we have a basic tracking-plot for the aggregated
repeat transactions</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.clv.fitted.transactions.html">plot</a></span><span class="op">(</span><span class="va">clv.apparel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Plotting from 2005-01-02 until 2010-12-26.</span></span></code></pre></div>
<p><img src="CLVTools_files/figure-html/plot-actual-1.png" width="100%">
To plot customers mean interpurchase time, we use:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.clv.fitted.transactions.html">plot</a></span><span class="op">(</span><span class="va">clv.apparel</span>, which<span class="op">=</span><span class="st">"interpurchasetime"</span><span class="op">)</span></span></code></pre></div>
<p><img src="CLVTools_files/figure-html/plot-interpurchase-1.png" width="100%">
When the <code><a href="../reference/plot.clv.fitted.transactions.html">plot()</a></code> command is applied to an object with the an
estimated model (i.e. <code>est.pnbd</code>), the following plots can be
selected using the <code>which</code> option of:</p>
<ul>
<li>Tracking plot (<code>which="tracking"</code>): plots the actual
repeat transactions and overlays it with the repeat transaction as
predicted by the fitted model. Currently, following previous literature,
the in-sample unconditional expectation is plotted in the holdout
period. The period can be specified using the
<code>prediction.end</code> option. It is also possible to generate
cumulative tracking plots (<code>cumulative = FALSE</code>). The
tracking plot is th the default option. The argument
<code>transactions</code> disable for plotting actual transactions
(<code>transactions=FALSE</code>). For further plotting options see the
documentation. Note that only whole periods can be plotted and that the
prediction end might not exactly match prediction.end. See the
<code><a href="../reference/plot.clv.data.html">?plot.clv.data</a></code> for more details.</li>
<li>Probability mass function (pmf) plot (<code>which="pmf"</code>):
plots the actual and expected number of customers which made a given
number of repeat transaction in the estimation period. The expected
number is based on the PMF of the fitted model, the probability to make
exactly a given number of repeat transactions in the estimation period.
For each bin, the expected number is the sum of all customers’
individual PMF value. The bins for the transactions can be adjusted
using the option <code>trans.bins</code>. (Note that if
<code>trans.bins</code> is changed, <code>label.remaining</code> usually
needs to be adapted as well.</li>
</ul>
<p>For a standard tracking plot including the model, we use:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.clv.fitted.transactions.html">plot</a></span><span class="op">(</span><span class="va">est.pnbd</span><span class="op">)</span></span>
<span><span class="co">#&gt; Plotting from 2005-01-02 until 2010-12-26.</span></span></code></pre></div>
<p><img src="CLVTools_files/figure-html/plot-model-1.png" width="100%"></p>
<p>To plot the <em>cumulative</em> expected transactions 30 time units
(30 weeks in this example) ahead of the end of the estimation plot, we
use:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.clv.fitted.transactions.html">plot</a></span><span class="op">(</span><span class="va">est.pnbd</span>, prediction.end <span class="op">=</span> <span class="fl">30</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, it is possible to specify a date for the
<code>prediction.end</code>argument. Note that dates are rounded to the
next full time unit (i.e. week):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.clv.fitted.transactions.html">plot</a></span><span class="op">(</span><span class="va">est.pnbd</span>, prediction.end <span class="op">=</span> <span class="st">"2006-05-08"</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>For a plot of the probability mass function (pmf), with 7 bins, we
use:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.clv.fitted.transactions.html">plot</a></span><span class="op">(</span><span class="va">est.pnbd</span>, which<span class="op">=</span><span class="st">"pmf"</span>, trans.bins<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span>, label.remaining<span class="op">=</span><span class="st">"6+"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="covariates">Covariates<a class="anchor" aria-label="anchor" href="#covariates"></a>
</h3>
<p><code>CLVTools</code> provides the option to include covariates into
probabilistic customer attrition models. Covariates may affect the
purchase or the attrition process, or both. It is also possible to
include different covariates for the two processes. However, support for
covariates is dependent on the model. Not all implemented models provide
an option for covariates. In general, <code>CLVTools</code>
distinguishes between two types of covariates: time-invariant and
time-varying. The former include factors that do not change over time
such as customer demographics or customer acquisition information. The
latter may change over time and include marketing activities or seasonal
patterns.</p>
<p>Data for time-invariant covariates must contain a unique customer ID
and a single value for each covariate. It should be supplied as a
<code>data.frame</code> or <code>data.table</code>. In the example of
the apparel retailer we use demographic information “gender” as
time-invariant and information on the acquisition channel as covariate
for both, the purchase and the attrition process. Use the
<code>data("apparelStaticCov")</code> command to load the time-invariant
covariates. In this example gender is coded as a dummy variable with
<code>male=0</code> and <code>female=1</code> and channel with
<code>online=0</code> and <code>offline=1</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"apparelStaticCov"</span><span class="op">)</span></span>
<span><span class="va">apparelStaticCov</span></span>
<span><span class="co">#&gt;          Id Gender Channel</span></span>
<span><span class="co">#&gt;      &lt;char&gt;  &lt;num&gt;   &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:      1      0       0</span></span>
<span><span class="co">#&gt;   2:      2      1       0</span></span>
<span><span class="co">#&gt;   3:      3      1       0</span></span>
<span><span class="co">#&gt;   4:      4      1       0</span></span>
<span><span class="co">#&gt;   5:      5      1       0</span></span>
<span><span class="co">#&gt;  ---                      </span></span>
<span><span class="co">#&gt; 596:    596      0       1</span></span>
<span><span class="co">#&gt; 597:    597      0       1</span></span>
<span><span class="co">#&gt; 598:    598      1       0</span></span>
<span><span class="co">#&gt; 599:    599      0       1</span></span>
<span><span class="co">#&gt; 600:    600      0       0</span></span></code></pre></div>
<p>Data for time-varying covariates requires a time-series of covariate
values for every customer. I.e. if the time-varying covariates are
allowed to change every week, a value for every customer for every week
is required. Note that all contextual factors are required to use the
same time intervals for the time-series. In the example of the apparel
retailer we use information on seasonal patterns
(<code>High.Season</code>) as time-varying covariate. Additionally, we
add gender as time-invariant contextual factors. Note that the data
structure of invariant covariates needs to be aligned with the structure
of time-varying covariate. Use <code>data("apparelDynCov")</code>
command to load</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"apparelDynCov"</span><span class="op">)</span></span>
<span><span class="va">apparelDynCov</span></span>
<span><span class="co">#&gt;             Id   Cov.Date High.Season Gender Channel</span></span>
<span><span class="co">#&gt;         &lt;char&gt;     &lt;Date&gt;       &lt;num&gt;  &lt;num&gt;   &lt;num&gt;</span></span>
<span><span class="co">#&gt;      1:      1 2005-01-02           0      0       0</span></span>
<span><span class="co">#&gt;      2:      1 2005-01-09           0      0       0</span></span>
<span><span class="co">#&gt;      3:      1 2005-01-16           0      0       0</span></span>
<span><span class="co">#&gt;      4:      1 2005-01-23           0      0       0</span></span>
<span><span class="co">#&gt;      5:      1 2005-01-30           0      0       0</span></span>
<span><span class="co">#&gt;     ---                                             </span></span>
<span><span class="co">#&gt; 187796:    600 2010-11-28           1      0       0</span></span>
<span><span class="co">#&gt; 187797:    600 2010-12-05           1      0       0</span></span>
<span><span class="co">#&gt; 187798:    600 2010-12-12           0      0       0</span></span>
<span><span class="co">#&gt; 187799:    600 2010-12-19           0      0       0</span></span>
<span><span class="co">#&gt; 187800:    600 2010-12-26           0      0       0</span></span></code></pre></div>
<p>To add the covariates to an initialized <code>clvdata</code> object
the commands <code><a href="../reference/SetStaticCovariates.html">SetStaticCovariates()</a></code> and
<code><a href="../reference/SetDynamicCovariates.html">SetDynamicCovariates()</a></code> are available. The two commands are
mutually exclusive. The argument <code>clv.data</code> specifies the
initialized object and the argument <code>data.cov.life</code>
respectively <code>data.cov.trans</code> specifies the data source for
the covariates for the attrition and the purchase process. Covariates
are added separately for the purchase and the attrition process.
Therefore if a covariate should affect both processes it has to be added
in both arguments: <code>data.cov.life</code> <em>and</em>
<code>data.cov.trans</code>. The arguments <code>names.cov.life</code>
and <code>names.cov.trans</code> specify the column names of the
covariates for the two processes. In our example, we use the same
covariates for both processes. Accordingly, we specify the
time-invariant covariates “Gender” and “Channel” as follows:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clv.static</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/SetStaticCovariates.html">SetStaticCovariates</a></span><span class="op">(</span>clv.data <span class="op">=</span> <span class="va">clv.apparel</span>, </span>
<span>                                      data.cov.life <span class="op">=</span> <span class="va">apparelStaticCov</span>, </span>
<span>                                      data.cov.trans <span class="op">=</span> <span class="va">apparelStaticCov</span>,</span>
<span>                                      names.cov.life <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gender"</span>, <span class="st">"Channel"</span><span class="op">)</span>, </span>
<span>                                      names.cov.trans <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gender"</span>, <span class="st">"Channel"</span><span class="op">)</span>, </span>
<span>                                      name.id <span class="op">=</span> <span class="st">"Id"</span><span class="op">)</span></span></code></pre></div>
<p>To specify the time-varying contextual factors for seasonal patterns,
we use the following:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clv.dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SetDynamicCovariates.html">SetDynamicCovariates</a></span><span class="op">(</span>clv.data <span class="op">=</span> <span class="va">clv.apparel</span>, </span>
<span>                                     data.cov.life <span class="op">=</span> <span class="va">apparelDynCov</span>,</span>
<span>                                     data.cov.trans <span class="op">=</span> <span class="va">apparelDynCov</span>, </span>
<span>                                     names.cov.life <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High.Season"</span>, <span class="st">"Gender"</span>, <span class="st">"Channel"</span><span class="op">)</span>, </span>
<span>                                     names.cov.trans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High.Season"</span>, <span class="st">"Gender"</span>, <span class="st">"Channel"</span><span class="op">)</span>, </span>
<span>                                     name.id <span class="op">=</span> <span class="st">"Id"</span>,</span>
<span>                                     name.date <span class="op">=</span> <span class="st">"Cov.Date"</span><span class="op">)</span></span></code></pre></div>
<p>In order to include time-invariant covariates in a time-varying
model, they may be recoded as a time-varying covariate with a constant
value in every time period.</p>
<p>Once the covariates are added to the model the estimation process is
almost identical to the standard model without covariates. The only
difference is that the provided object now data for contains either
time-invariant or time-varying covariates and the option to define start
parameters for the covariates of both processes using the arguments
<code>start.params.life</code> and <code>start.params.trans</code>. If
not set, the staring values are set to 1. To define starting parameters
for the covariates, the name of the corresponding factor has to be used.
For example in the case of time-invariant covariates:</p>
<p>To execute the model estimation you have the choice between a
formula-based interface and a non-formula-based interface. In the
following we illustrate the two alternatives.</p>
<div class="section level4">
<h4 id="estimating-the-model-using-formula-interface-2">
<strong>Estimating the model using formula interface</strong>:<a class="anchor" aria-label="anchor" href="#estimating-the-model-using-formula-interface-2"></a>
</h4>
<p>We use all present covariates:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">est.pnbd.static</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latentAttrition.html">latentAttrition</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">.</span><span class="op">|</span><span class="va">.</span>, family <span class="op">=</span> <span class="va">pnbd</span>, data<span class="op">=</span><span class="va">clv.static</span><span class="op">)</span></span></code></pre></div>
<p>Using the formula interface, we can use only selected covariates
(only Gender for the lifetime process and both, Channel and Gender for
the transaction process):</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">est.pnbd.static</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latentAttrition.html">latentAttrition</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">Gender</span><span class="op">|</span><span class="va">Channel</span><span class="op">+</span><span class="va">Gender</span>, </span>
<span>                                     family <span class="op">=</span> <span class="va">pnbd</span>, data<span class="op">=</span><span class="va">clv.static</span><span class="op">)</span></span></code></pre></div>
<p>Or we can transform covariates:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">est.pnbd.static</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latentAttrition.html">latentAttrition</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">Channel</span><span class="op">+</span><span class="va">Gender</span><span class="op">|</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Channel</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                     family <span class="op">=</span> <span class="va">pnbd</span>, data<span class="op">=</span><span class="va">clv.static</span><span class="op">)</span></span></code></pre></div>
<p>Analogously, we can estimate the model containing time-varying
covariates. In this example we also activate output of the optimizer in
order to observe the progress.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.pnbd.dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latentAttrition.html">latentAttrition</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">.</span><span class="op">|</span><span class="va">.</span>, family <span class="op">=</span> <span class="va">pnbd</span>, data <span class="op">=</span> <span class="va">clv.dyn</span>, </span>
<span>                                optimx.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="estimating-the-model-using-non-formula-interface-2">
<strong>Estimating the model using non-formula
interface</strong>:<a class="anchor" aria-label="anchor" href="#estimating-the-model-using-non-formula-interface-2"></a>
</h4>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.pnbd.static</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span><span class="op">(</span><span class="va">clv.static</span>, </span>
<span>                         start.params.model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>r<span class="op">=</span><span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">2</span>, s <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         start.params.life <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Gender<span class="op">=</span><span class="fl">0.6</span>, Channel<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                         start.params.trans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Gender<span class="op">=</span><span class="fl">0.6</span>, Channel<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting estimation...</span></span>
<span><span class="co">#&gt; Estimation finished!</span></span></code></pre></div>
<p>It is not possible to alter or select covariates in the non-formula
interface, but, we can also estimate a model containing time-varying
covariates:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.pnbd.dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span><span class="op">(</span><span class="va">clv.dyn</span>, </span>
<span>                     start.params.model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>r<span class="op">=</span><span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">2</span>, s <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                     start.params.life <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>High.Season<span class="op">=</span><span class="fl">0.5</span>, Gender<span class="op">=</span><span class="fl">0.6</span>, Channel<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                     start.params.trans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>High.Season<span class="op">=</span><span class="fl">0.5</span>, Gender<span class="op">=</span><span class="fl">0.6</span>, Channel<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                     optimx.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To inspect the estimated model we use <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, however
all other commands such as <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>, <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code>,
<code>loglike()</code>, <code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code> and <code><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov()</a></code>
are also available. Now, output contains also parameters for the
covariates for both processes. Since covariates are added separately for
the purchase and the attrition process, there are also separate model
parameters for the two processes. These parameters are directly
interpretable as rate elasticity of the corresponding factors: A 1%
change in a contextual factor <span class="math inline">$\bf{X}^{P}$</span> or <span class="math inline">$\bf{X}^{L}$</span> changes the purchase or the
attrition rate by <span class="math inline">$\gamma_{purch}\bf{X}^{P}$</span> or <span class="math inline">$\gamma_{life}\bf{X}^{L}$</span> percent,
respectively <span class="citation">(Gupta 1991)</span>. In the example
of the apparel retailer, we observe that female customer purchase
significantly more (<code>trans.Gender=1.42576</code>). Note, that
female customers are coded as 1, male customers as 0. Also customers
acquired offline (coded as Channel=1), purchase more
(<code>trans.Channel=0.40304</code>) and stay longer
(<code>life.Channel=0.9343</code>). Make sure to check the
Karush-Kuhn-Tucker optimality conditions of the first and second order
<span class="citation">(Kuhn and Tucker 1951)</span> (KKT1 and KKT1)
before interpreting the parameters. If those criteria are not met, the
optimizer has probably not arrived at an optimal solution. If this is
the case it is usually a good idea to rerun the estimation using
alternative starting values.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est.pnbd.static</span><span class="op">)</span></span>
<span><span class="co">#&gt; Pareto/NBD with Static Covariates  Model </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; pnbd(clv.data = clv.static, start.params.model = c(r = 1, alpha = 2, </span></span>
<span><span class="co">#&gt;     s = 1, beta = 2), start.params.life = c(Gender = 0.6, Channel = 0.4), </span></span>
<span><span class="co">#&gt;     start.params.trans = c(Gender = 0.6, Channel = 0.4))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fitting period:                                </span></span>
<span><span class="co">#&gt; Estimation start  2005-01-02    </span></span>
<span><span class="co">#&gt; Estimation end    2006-12-31    </span></span>
<span><span class="co">#&gt; Estimation length 104.0000 Weeks</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error  z-val Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; r               1.8387     0.3457  5.319 1.04e-07 ***</span></span>
<span><span class="co">#&gt; alpha          92.9435    16.9749  5.475 4.37e-08 ***</span></span>
<span><span class="co">#&gt; s               0.5913     0.2603  2.272  0.02311 *  </span></span>
<span><span class="co">#&gt; beta           49.5050    36.1445  1.370  0.17080    </span></span>
<span><span class="co">#&gt; life.Gender    -0.6428     0.2956 -2.175  0.02965 *  </span></span>
<span><span class="co">#&gt; life.Channel    0.7902     0.3058  2.584  0.00978 ** </span></span>
<span><span class="co">#&gt; trans.Gender    0.2860     0.1041  2.746  0.00603 ** </span></span>
<span><span class="co">#&gt; trans.Channel   0.6239     0.1049  5.945 2.76e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimization info:                 </span></span>
<span><span class="co">#&gt; LL     -5821.0627</span></span>
<span><span class="co">#&gt; AIC    11658.1254</span></span>
<span><span class="co">#&gt; BIC    11693.3008</span></span>
<span><span class="co">#&gt; KKT 1  TRUE      </span></span>
<span><span class="co">#&gt; KKT 2  TRUE      </span></span>
<span><span class="co">#&gt; fevals 60.0000   </span></span>
<span><span class="co">#&gt; Method L-BFGS-B  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Used Options:                     </span></span>
<span><span class="co">#&gt; Correlation     FALSE</span></span>
<span><span class="co">#&gt; Regularization  FALSE</span></span>
<span><span class="co">#&gt; Constraint covs FALSE</span></span></code></pre></div>
<p>To predict future customer behavior we use <code><a href="../reference/predict.clv.fitted.transactions.html">predict()</a></code>.
Note that dependent on the model, the predicted metrics may differ. For
example, in the case of the Pareto/NBD model with time-varying
covariates, instead of DERT, DECT is predicted. DECT only covers a
finite time horizon in contrast to DERT. Time-varying covariates must be
provided for the entire prediction period. If the data initially
provided in the <code><a href="../reference/SetDynamicCovariates.html">SetDynamicCovariates()</a></code> command does not
cover the complete prediction period, the argument <code>new.data</code>
offers the ability to supply new data for the time-varying covariates in
the from of a <code>clvdata</code> object.</p>
</div>
</div>
<div class="section level3">
<h3 id="add-correlation-to-the-model">Add Correlation to the model<a class="anchor" aria-label="anchor" href="#add-correlation-to-the-model"></a>
</h3>
<p>To relax the assumption of independence between the purchase and the
attrition process, <code>CLVTools</code> provides the option to specify
the argument <code>use.cor</code> when fitting the model
(i.e. <code>pnbd</code>). In case of <code>use.cor=TRUE</code>, a
Sarmanov approach is used to correlate the two processes.
<code>start.param.cor</code> allows to optionally specify a starting
value for the correlation parameter. Correlation can be added with or
without covariates.</p>
<p>To execute the model estimation you have the choice between a
formula-based interface and a non-formula-based interface. In the
following we illustrate the two alternatives.</p>
<div class="section level4">
<h4 id="estimating-the-model-using-formula-interface-3">
<strong>Estimating the model using formula interface:</strong><a class="anchor" aria-label="anchor" href="#estimating-the-model-using-formula-interface-3"></a>
</h4>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.pnbd.cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latentAttrition.html">latentAttrition</a></span><span class="op">(</span>formula <span class="op">=</span> , family <span class="op">=</span> <span class="va">pnbd</span>, </span>
<span>                                use.cor<span class="op">=</span><span class="cn">TRUE</span>, data<span class="op">=</span><span class="va">clv.apparel</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="estimating-the-model-using-non-formula-interface-3">
<strong>Estimating the model using non-formula
interface:</strong><a class="anchor" aria-label="anchor" href="#estimating-the-model-using-non-formula-interface-3"></a>
</h4>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.pnbd.cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span><span class="op">(</span><span class="va">clv.apparel</span>, </span>
<span>                     use.cor<span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est.pnbd.cor</span><span class="op">)</span></span></code></pre></div>
<p>The parameter <code>Cor(life,trans)</code> is added to the parameter
estimates that may be directly interpreted as a correlation. In the
example of the apparel retailer the correlation parameter is not
significant and the correlation is very close to zero, indicating that
the purchase and the attrition process may be independent.</p>
</div>
</div>
<div class="section level3">
<h3 id="advanced-options-for-covariates">Advanced Options for Covariates<a class="anchor" aria-label="anchor" href="#advanced-options-for-covariates"></a>
</h3>
<p><code>CLVTools</code> provides two additional estimation options for
models containing covariates (time-invariant or time-varying):
regularization and constraints for the parameters of the covariates.
Support for this option is dependent on the model. They may be used
simultaneously.</p>
<p>In the following we illustrate code for both, a formula-based
interface a non-formula-based interface.</p>
<p><strong><em>Regularization</em></strong> helps to prevent overfitting
of the model when using covariates. We can add regularization lambdas
for the two processes. The larger the lambdas the stronger the effects
of the regularization. Regularization only affects the parameters of the
covariates. The use of regularization is indicated at the end of the
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> output.</p>
<div class="section level4">
<h4 id="estimating-the-model-using-formula-interface-4">
<strong>Estimating the model using formula interface:</strong><a class="anchor" aria-label="anchor" href="#estimating-the-model-using-formula-interface-4"></a>
</h4>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.pnbd.reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latentAttrition.html">latentAttrition</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">.</span><span class="op">|</span><span class="va">.</span>, family <span class="op">=</span> <span class="va">pnbd</span>, </span>
<span>                                reg.lambdas<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>life<span class="op">=</span><span class="fl">3</span>, trans<span class="op">=</span><span class="fl">8</span><span class="op">)</span>, data<span class="op">=</span><span class="va">clv.static</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est.pnbd.reg</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="estimating-the-model-using-non-formula-interface-4">
<strong>Estimating the model using non-formula
interface:</strong><a class="anchor" aria-label="anchor" href="#estimating-the-model-using-non-formula-interface-4"></a>
</h4>
<p>We use the argument <code>reg.lambdas</code> to specify the lambdas
for the two processes
(i.e. <code>reg.lambdas = c(trans=100, life=100)</code>:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.pnbd.reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span><span class="op">(</span><span class="va">clv.static</span>, </span>
<span>                         start.params.model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>r<span class="op">=</span><span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">2</span>, s <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         reg.lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>trans<span class="op">=</span><span class="fl">100</span>, life<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est.pnbd.reg</span><span class="op">)</span></span></code></pre></div>
<p><strong><em>Constraints</em></strong> implement equality constraints
for contextual factors with regards to the two processes. For example
the variable “gender” is forced to have the same effect on the purchase
as well as on the attrition process. We can use the argument
<code>names.cov.constr</code>(i.e. <code>names.cov.constr=c("Gender")</code>).
In this case, the output only contains one parameter for “Gender” as it
is constrained to be the same for both processes. To provide starting
parameters for the constrained variable use
<code>start.params.constr</code>. The use of constraints is indicated at
the end of the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> output.</p>
</div>
<div class="section level4">
<h4 id="estimating-the-model-using-formula-interface-5">
<strong>Estimating the model using formula interface:</strong><a class="anchor" aria-label="anchor" href="#estimating-the-model-using-formula-interface-5"></a>
</h4>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.pnbd.constr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latentAttrition.html">latentAttrition</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span><span class="va">.</span><span class="op">|</span><span class="va">.</span>, family <span class="op">=</span> <span class="va">pnbd</span>, data <span class="op">=</span> <span class="va">clv.static</span>,</span>
<span>                                   names.cov.constr<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gender"</span><span class="op">)</span>, </span>
<span>                                   start.params.constr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Gender <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est.pnbd.constr</span><span class="op">)</span></span></code></pre></div>
<p>Note: providing a starting parameter for the constrained variable is
optional.</p>
</div>
<div class="section level4">
<h4 id="estimating-the-model-using-non-formula-interface-5">
<strong>Estimating the model using non-formula
interface:</strong><a class="anchor" aria-label="anchor" href="#estimating-the-model-using-non-formula-interface-5"></a>
</h4>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.pnbd.constr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span><span class="op">(</span><span class="va">clv.static</span>, </span>
<span>                         start.params.model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>r<span class="op">=</span><span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">2</span>, s <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         start.params.constr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Gender<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span>,</span>
<span>                         names.cov.constr<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Gender"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est.pnbd.constr</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="spending">Customer Spending<a class="anchor" aria-label="anchor" href="#spending"></a>
</h2>
<p>Customer lifetime value (CLV) is composed of three components of
every customer: the future level of transactions, expected attrition
behaviour (i.e. probability of being alive) and the monetary value.
While probabilistic latent attrition models provide metrics for the
first two components, they do not predict customer spending. To predict
customer spending an additional model is required. The
<code>CLVTools</code>package features the Gamma/Gamma (G/G) <span class="citation">(Fader, Hardie, and Lee 2005b; Colombo and Jiang
1999)</span> model for predicting customer spending. For convenience,
the <code><a href="../reference/predict.clv.fitted.transactions.html">predict()</a></code> command allows to automatically predict
customer spending for all latent attrition models using the option
<code>predict.spending=TRUE</code> (see section <a href="#spending">Customer Spending</a>). However, to provide more
options and more granular insights the Gamma/Gamma model can be
estimated independently. In the following, we discuss how to estimate a
Gamma/Gamma model using <code>CLVTools</code>.</p>
<p>The general workflow remains identical. It consists of the three main
steps: (1) creating a <code>clv.data</code> object containing the
dataset and required meta-information, (2) fitting the model on the
provided data and (3) predicting future customer purchase behavior based
on the fitted model.</p>
<p><code>CLVTools</code> provides two ways for evaluating spending
models: you can use of the formula interface or you can use standard
functions (non-formula interface). Both offer the same functionality.
Through out this walkthrough, we will illustrate both options.</p>
<p>Reporting and plotting results is facilitated by the implementation
of well-known generic methods such as <code><a href="../reference/plot.clv.fitted.transactions.html">plot()</a></code>,
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> and <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>.</p>
<div class="section level3">
<h3 id="load-sample-data-provided-in-the-package-1">Load sample data provided in the package<a class="anchor" aria-label="anchor" href="#load-sample-data-provided-in-the-package-1"></a>
</h3>
<p>For estimating customer spending <code>CLVTools</code> requires
customers’ transaction history including price. Every transaction record
consists of a purchase date,customer ID and the price of the
transaction. Data may be provided as <code>data.frame</code> or
<code>data.table</code> <span class="citation">(Dowle and Srinivasan
2019)</span>. Currently, the Gamma/Gamma model does not allow for
covariates.</p>
<p>We use again simulated data comparable to data from a retailer in the
apparel industry. The apparel dataset is available in the
<code>CLVTools</code> package. We use the
<code>data(apparelTrans)</code> to load it and initialize a data object
using the <code><a href="../reference/clvdata.html">clvdata()</a></code> command. For details see section <a href="#clvdata">Initialize the CLV-Object</a>.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"apparelTrans"</span><span class="op">)</span></span>
<span><span class="va">apparelTrans</span></span>
<span><span class="co">#&gt;           Id       Date  Price</span></span>
<span><span class="co">#&gt;       &lt;char&gt;     &lt;Date&gt;  &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:      1 2005-01-02 230.30</span></span>
<span><span class="co">#&gt;    2:      1 2005-09-06  84.39</span></span>
<span><span class="co">#&gt;    3:      1 2006-01-18 131.07</span></span>
<span><span class="co">#&gt;    4:      1 2006-04-05  86.43</span></span>
<span><span class="co">#&gt;    5:      1 2006-07-02  11.49</span></span>
<span><span class="co">#&gt;   ---                         </span></span>
<span><span class="co">#&gt; 3183:    600 2005-01-02  24.94</span></span>
<span><span class="co">#&gt; 3184:    600 2005-04-17  54.97</span></span>
<span><span class="co">#&gt; 3185:    600 2005-06-30  66.84</span></span>
<span><span class="co">#&gt; 3186:    600 2005-10-27  22.54</span></span>
<span><span class="co">#&gt; 3187:    600 2006-01-09  12.97</span></span>
<span></span>
<span><span class="va">clv.apparel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clvdata.html">clvdata</a></span><span class="op">(</span><span class="va">apparelTrans</span>,  </span>
<span>                       date.format<span class="op">=</span><span class="st">"ymd"</span>, </span>
<span>                       time.unit <span class="op">=</span> <span class="st">"week"</span>,</span>
<span>                       estimation.split <span class="op">=</span> <span class="fl">40</span>,</span>
<span>                       name.id <span class="op">=</span> <span class="st">"Id"</span>,</span>
<span>                       name.date <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>                       name.price <span class="op">=</span> <span class="st">"Price"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimate-model-parameters">Estimate Model Parameters<a class="anchor" aria-label="anchor" href="#estimate-model-parameters"></a>
</h3>
<p>To estimate the Gamma/Gamma spending model, we use the command
<code><a href="../reference/gg.html">gg()</a></code> on the initialized <code>clvdata</code> object.
<code>clv.data</code> specifies the initialized object prepared in the
last step. Optionally, starting values for the model parameters and
control settings for the optimization algorithm may be provided: The
argument <code>start.params.model</code> allows to assign a vector of
starting values for the optimization (i.e
<code>c(p=1, q=2, gamma=1)</code> for the the Gamma/Gamma model). This
is useful if prior knowledge on the parameters of the distributions are
available. By default starting values are set to 1 for all parameters.
The argument <code>optimx.args</code> provides an option to control
settings for the optimization routine (see section <a href="#estimate">Estimate Model Parameters</a>).</p>
<p>In line with literature, <code>CLVTools</code> does not use by
default the monetary value of the first transaction to fit the model
since it might be atypical of future purchases. If the first transaction
should be considered the argument <code>remove.first.transaction</code>
can be set to <code>FALSE</code>.</p>
<p>To execute the model estimation you have the choice between a
formula-based interface and a non-formula-based interface. In the
following we illustrate the two alternatives.</p>
<div class="section level4">
<h4 id="estimating-the-model-using-formula-interface-6">
<strong>Estimating the model using formula interface:</strong><a class="anchor" aria-label="anchor" href="#estimating-the-model-using-formula-interface-6"></a>
</h4>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spending.html">spending</a></span><span class="op">(</span>family <span class="op">=</span> <span class="va">gg</span>, data<span class="op">=</span><span class="va">clv.apparel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting estimation...</span></span>
<span><span class="co">#&gt; Estimation finished!</span></span>
<span><span class="va">est.gg</span></span>
<span><span class="co">#&gt; Gamma-Gamma Model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; spending(family = gg, data = clv.apparel)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;      p       q   gamma  </span></span>
<span><span class="co">#&gt;  3.675   4.630  36.111  </span></span>
<span><span class="co">#&gt; KKT1: TRUE </span></span>
<span><span class="co">#&gt; KKT2: TRUE</span></span></code></pre></div>
<p>Using start parameters or other additional arguments for the
optimizer:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spending.html">spending</a></span><span class="op">(</span>family <span class="op">=</span> <span class="va">gg</span>, data<span class="op">=</span><span class="va">clv.apparel</span>, </span>
<span>                   optimx.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   start.params.model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">0.5</span>, q<span class="op">=</span><span class="fl">15</span>, gamma<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Specify the option to NOT remove the first transaction:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spending.html">spending</a></span><span class="op">(</span>family <span class="op">=</span> <span class="va">gg</span>, data<span class="op">=</span><span class="va">clv.apparel</span>, </span>
<span>                   remove.first.transaction<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="estimating-the-model-using-non-formula-interface-6">
<strong>Estimating the model using non-formula
interface:</strong><a class="anchor" aria-label="anchor" href="#estimating-the-model-using-non-formula-interface-6"></a>
</h4>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.gg</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span>clv.data <span class="op">=</span> <span class="va">clv.apparel</span><span class="op">)</span></span>
<span><span class="va">est.gg</span></span></code></pre></div>
<p>Using start parameters and other additional arguments for the
optimzier:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.gg</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span>start.params.model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">0.5</span>, q<span class="op">=</span><span class="fl">15</span>, gamma<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, clv.data <span class="op">=</span> <span class="va">clv.apparel</span><span class="op">)</span></span>
<span><span class="va">est.gg</span></span></code></pre></div>
<p>Specify the option to NOT remove the first transaction:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.gg</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/gg.html">gg</a></span><span class="op">(</span>clv.data <span class="op">=</span> <span class="va">clv.apparel</span>, remove.first.transaction<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">est.gg</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="predictspending">Predict Customer Spending<a class="anchor" aria-label="anchor" href="#predictspending"></a>
</h3>
<p>Once the model parameters are estimated, we are able to predict
future customer mean spending on an individual level. To do so, we use
<code><a href="../reference/predict.clv.fitted.transactions.html">predict()</a></code> on the object with the estimated parameters
(i.e. <code>est.gg</code>). Note that there is no need to specify a
prediction period as we predict mean spending.</p>
<p>In general, probabilistic spending models predict the following
expected characteristic for every customer:</p>
<ul>
<li>predicted mean spending (“predicted.mean.spending”)</li>
</ul>
<p>If a holdout period is available additionally the true mean spending
(“actual.mean.spending”) during the holdout period is reported.</p>
<p>To use the parameter estimates on new data (e.g., an other customer
cohort), the argument <code>newdata</code> optionally allows to provide
a new <code>clvdata</code> object.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results.spending</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict.clv.fitted.transactions.html">predict</a></span><span class="op">(</span><span class="va">est.gg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results.spending</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;Id&gt;</span></span>
<span><span class="co">#&gt;          Id actual.mean.spending predicted.mean.spending</span></span>
<span><span class="co">#&gt;      &lt;char&gt;                &lt;num&gt;                   &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:      1            104.82000                60.62446</span></span>
<span><span class="co">#&gt;   2:     10             31.65500                37.71808</span></span>
<span><span class="co">#&gt;   3:    100             37.03889                36.56190</span></span>
<span><span class="co">#&gt;   4:    101              0.00000                33.24045</span></span>
<span><span class="co">#&gt;   5:    102              0.00000                36.56190</span></span>
<span><span class="co">#&gt;  ---                                                    </span></span>
<span><span class="co">#&gt; 596:     95             22.76000                28.96908</span></span>
<span><span class="co">#&gt; 597:     96             84.53667                36.56190</span></span>
<span><span class="co">#&gt; 598:     97              0.00000                36.56190</span></span>
<span><span class="co">#&gt; 599:     98             33.14000                36.56190</span></span>
<span><span class="co">#&gt; 600:     99             13.99000                17.43526</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-spendings">Plot Spendings<a class="anchor" aria-label="anchor" href="#plot-spendings"></a>
</h3>
<p>an estimated spending model object (i.e. <code>est.gg</code>) may be
plotted using the <code><a href="../reference/plot.clv.fitted.transactions.html">plot()</a></code> command. The plot provides a
comparison of the estimated and actual density of customer spending. The
argument <code>plot.interpolation.points</code> allows to adjust the
number of interpolation points in density graph.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.clv.fitted.transactions.html">plot</a></span><span class="op">(</span><span class="va">est.gg</span><span class="op">)</span></span></code></pre></div>
<p><img src="CLVTools_files/figure-html/spending-plot-model4-1.png" width="100%"></p>
<div class="section level4">
<h4 class="unnumbered" id="literature">Literature<a class="anchor" aria-label="anchor" href="#literature"></a>
</h4>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Bemmaor2012a" class="csl-entry">
Bemmaor, Albert. C., and Nicolas Glady. 2012. <span>“<span class="nocase">Modeling Purchasing Behavior with Sudden "Death": A
Flexible Customer Lifetime Model</span>.”</span> <em>Management
Science</em> 58 (5): 1012–21.
</div>
<div id="ref-byrd1995limited" class="csl-entry">
Byrd, Richard H, Peihuang Lu, Jorge Nocedal, and Ciyou Zhu. 1995.
<span>“A Limited Memory Algorithm for Bound Constrained
Optimization.”</span> <em>SIAM Journal on Scientific Computing</em> 16
(5): 1190–1208.
</div>
<div id="ref-Colombo1999" class="csl-entry">
Colombo, Richard, and Weina Jiang. 1999. <span>“<a href="https://www.ncbi.nlm.nih.gov/pubmed/20518988" class="external-link"><span class="nocase">A stochastic RFM model</span></a>.”</span> <em>Journal of
Interactive Marketing</em> 13 (3): 2–12.
</div>
<div id="ref-data.table" class="csl-entry">
Dowle, Matt, and Arun Srinivasan. 2019. <em>Data.table: Extension of
’Data.frame’</em>. <a href="https://CRAN.R-project.org/package=data.table" class="external-link">https://CRAN.R-project.org/package=data.table</a>.
</div>
<div id="ref-Fader2005c" class="csl-entry">
Fader, Peter S., Bruce G. S. Hardie, and KL Lee. 2005a. <span>“<span class="nocase">’Counting Your Customers’ the Easy Way: An Alternative to
the Pareto/NBD Model</span>.”</span> <em>Marketing Science</em> 24 (2):
275–84.
</div>
<div id="ref-Fader2005b" class="csl-entry">
———. 2005b. <span>“<span class="nocase">RFM and CLV: Using Iso-Value
Curves for Customer Base Analysis</span>.”</span> <em>Journal of
Marketing Research</em> 42 (4): 415–30.
</div>
<div id="ref-lubridate" class="csl-entry">
Grolemund, Garrett, and Hadley Wickham. 2011. <span>“Dates and Times
Made Easy with <span class="nocase">lubridate</span>.”</span>
<em>Journal of Statistical Software</em> 40 (3): 1–25. <a href="https://www.jstatsoft.org/article/view/v040i03" class="external-link">https://www.jstatsoft.org/article/view/v040i03</a>.
</div>
<div id="ref-Gupta1991" class="csl-entry">
Gupta, Sunil. 1991. <span>“<span class="nocase">Stochastic Models of
Interpurchase Time with Time-Dependent Covariates</span>.”</span>
<em>Journal of Marketing Research</em> 28 (1): 1–15.
</div>
<div id="ref-KKT" class="csl-entry">
Kuhn, H. W., and A. W. Tucker. 1951. <span>“Nonlinear
Programming.”</span> In <em>Second Berkeley Symposium on Mathematical
Statistics and Probability</em>, edited by J. Neyman, 481–92.
</div>
<div id="ref-optimx2" class="csl-entry">
Nash, John C. 2014. <span>“On Best Practice Optimization Methods in
<span>R</span>.”</span> <em>Journal of Statistical Software</em> 60 (2):
1–14. <a href="https://www.jstatsoft.org/article/view/v060i02" class="external-link">https://www.jstatsoft.org/article/view/v060i02</a>.
</div>
<div id="ref-optimx1" class="csl-entry">
Nash, John C., and Ravi Varadhan. 2011. <span>“Unifying Optimization
Algorithms to Aid Software System Users: <span class="nocase">optimx</span> for <span>R</span>.”</span> <em>Journal of
Statistical Software</em> 43 (9): 1–14. <a href="https://www.jstatsoft.org/article/view/v043i09" class="external-link">https://www.jstatsoft.org/article/view/v043i09</a>.
</div>
<div id="ref-nelder1965simplex" class="csl-entry">
Nelder, John A, and Roger Mead. 1965. <span>“A Simplex Method for
Function Minimization.”</span> <em>The Computer Journal</em> 7 (4):
308–13.
</div>
<div id="ref-Schmittlein1987" class="csl-entry">
Schmittlein, David C., Donald G. Morrison, and Richard Colombo. 1987.
<span>“<span class="nocase">Counting Your Customers: Who-Are They and
What Will They Do Next?</span>”</span> <em>Management Science</em> 33
(1): 1–24.
</div>
<div id="ref-devtools" class="csl-entry">
Wickham, Hadley, Jim Hester, and Winston Chang. 2019. <em>Devtools:
Tools to Make Developing r Packages Easier</em>. <a href="https://CRAN.R-project.org/package=devtools" class="external-link">https://CRAN.R-project.org/package=devtools</a>.
</div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Patrick Bachmann, Niels Kuebler, Markus Meierer, Jeffrey Naef, E. Shin Oblander, Patrik Schilter.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
