<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The CLVTools Package • CLVTools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The CLVTools Package">
<meta property="og:description" content="CLVTools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CLVTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/CLVTools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/internal_docu/internal_docu.html">Internal Package Documentation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bachmannpatrick/CLVTools/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>The CLVTools Package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bachmannpatrick/CLVTools/blob/master/vignettes/CLVTools.Rmd"><code>vignettes/CLVTools.Rmd</code></a></small>
      <div class="hidden name"><code>CLVTools.Rmd</code></div>

    </div>

    
    
<div id="walkthrough-for-the-clvtools-package" class="section level1">
<h1 class="hasAnchor">
<a href="#walkthrough-for-the-clvtools-package" class="anchor"></a>Walkthrough for the CLVTools package</h1>
<div id="setup-the-r-environment" class="section level2">
<h2 class="hasAnchor">
<a href="#setup-the-r-environment" class="anchor"></a>Setup the R environment</h2>
<p>Install the stable version from CRAN:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"CLVTools"</span>)</pre></body></html></div>
<p>Install the development version from GitHub (using the <code>devtools</code> <span class="citation">(Wickham, Hester, and Chang 2019)</span> package):</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_github</span>(<span class="st">"CLVTools"</span>, <span class="kw">ref</span> <span class="kw">=</span> <span class="st">"master"</span>)</pre></body></html></div>
<p>Load the package</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"CLVTools"</span>)</pre></body></html></div>
</div>
</div>
<div id="load-sample-data-provided-in-the-package" class="section level1">
<h1 class="hasAnchor">
<a href="#load-sample-data-provided-in-the-package" class="anchor"></a>Load sample data provided in the package</h1>
<p>As Input data <code>CLVTools</code> requires customers’ transaction history. Every transaction record consists of a purchase date and customer ID. Optionally, the price of the transaction may be included to allow for prediction of future customer spending using an additional Gamma/Gamma model<span class="citation">(Fader, Hardie, and Lee 2005b; Colombo and Jiang 1999)</span>. Using the full history of transaction data allows for comprehensive plots and summary statistics, which allow the identification of possible issues prior to model estimation. Data may be provided as <code>data.frame</code> or <code>data.table</code> <span class="citation">(Dowle and Srinivasan 2019)</span>.</p>
<p>It is common practice to split time series data into two parts, an estimation and a holdout period. The model is estimated based on the data from the estimation period while the data from the holdout period allows to rigorously assess model performance. Once model performance is checked on known data one can proceed to predict data without a holdout period. The length of the estimation period is heavily dependent on the characteristics of the analyzed dataset. We recommend to choose an estimation period that contains in minimum the length of the average inter-purchase time. Note that all customers in the dataset need to purchase at least once during the estimation period, i.e. these models do not account for prospects who have not yet a purchase record.</p>
<p>Some models included in <code>CLVTools</code> allow to model the impact of covariates. These covariates may explain heterogeneity among the customers and therefore increase the predictive accuracy of the model. At the same time we may also identify and quantify the effects of these covariates on customer purchase and customer attrition. <code>CLVTools</code> distinguishes between time-invariant and time-varying covariates. Time-invariant covariates include customer characteristics such as demographics that do not change over time. Time-varying covariates are allowed to change over time. They include for example direct marketing information or seasonal patterns.</p>
<p>For the following example, we use simulated data comparable to data from a retailer in the apparel industry. The dataset contains transactional detail records for every customer consisting of customer id, date of purchase and the total monetary value of the transaction.The apparel dataset is available in the <code>CLVTools</code> package. Use the <code><a href="https://rdrr.io/r/utils/data.html">data(apparelTrans)</a></code> to load it:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"apparelTrans"</span>)
<span class="no">apparelTrans</span>
<span class="co">#&gt;         Id       Date  Price</span>
<span class="co">#&gt;    1:    1 2005-01-03  26.95</span>
<span class="co">#&gt;    2:   10 2005-01-03  38.95</span>
<span class="co">#&gt;    3:   10 2005-02-25  93.73</span>
<span class="co">#&gt;    4:   10 2005-04-05 224.96</span>
<span class="co">#&gt;    5:  100 2005-01-03 104.95</span>
<span class="co">#&gt;   ---                       </span>
<span class="co">#&gt; 2349: 1221 2006-01-23  62.95</span>
<span class="co">#&gt; 2350: 1221 2006-03-09  89.95</span>
<span class="co">#&gt; 2351: 1221 2006-05-14  52.95</span>
<span class="co">#&gt; 2352: 1222 2005-01-03   5.90</span>
<span class="co">#&gt; 2353: 1222 2005-03-03  13.90</span></pre></body></html></div>
<div id="initialize-the-clv-object" class="section level2">
<h2 class="hasAnchor">
<a href="#initialize-the-clv-object" class="anchor"></a>Initialize the CLV-Object</h2>
<p>Before we estimate a model, we are required to initialize a data object using the <code><a href="../reference/clvdata.html">clvdata()</a></code> command. The data object contains the prepared transactional data and is later used as input for model fitting. Make sure to store the generated object in a variable, e.g. in our example <code>clv.apparel</code>.</p>
<p>Through the argument <code>data.transactions</code> a <code>data.frame</code> or <code>data.table</code> which contains the transaction records, is specified. In our example this is <code>data.transactions=apparelTrans</code>. The argument <code>date.format</code> is used to indicate the format of the date variable in the data used. The date format in the apparel dataset is given as “year-month-day” (i.e., “2005-01-03”), therefore we set <code>date.format="ymd"</code>. Other combinations such as <code>date.format="dmy"</code> are possible. See the documentation of <code>lubridate</code> <span class="citation">(Grolemund and Wickham 2011)</span> for all details. <code>time.unit</code> is the scale used to measure time between two dates. For this dataset and in most other cases The argument <code>time.unit="week"</code> is the preferred choice. Abbreviations may be used (i.e. “w”). <code>estimation.split</code> indicates the length of the estimation period. Either the length of the estimation period (in previous specified time units) or the date at which the estimation period ends can be specified. If no value is provided, the whole dataset is used as estimation period (i.e. no holdout period). In this example, we use an estimation period of 40 weeks. Finally, the three name arguments indicate the column names for customer ID, date and price in the supplied dataset. Note that the price column is optional.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">clv.apparel</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/clvdata.html">clvdata</a></span>(<span class="no">apparelTrans</span>,
                       <span class="kw">date.format</span><span class="kw">=</span><span class="st">"ymd"</span>,
                       <span class="kw">time.unit</span> <span class="kw">=</span> <span class="st">"week"</span>,
                       <span class="kw">estimation.split</span> <span class="kw">=</span> <span class="fl">40</span>,
                       <span class="kw">name.id</span> <span class="kw">=</span> <span class="st">"Id"</span>,
                       <span class="kw">name.date</span> <span class="kw">=</span> <span class="st">"Date"</span>,
                       <span class="kw">name.price</span> <span class="kw">=</span> <span class="st">"Price"</span>)</pre></body></html></div>
</div>
<div id="check-the-clvdata-object" class="section level2">
<h2 class="hasAnchor">
<a href="#check-the-clvdata-object" class="anchor"></a>Check the <code>clvdata</code> Object</h2>
<p>To get details on the <code>clvdata</code> object, print it to the console.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">clv.apparel</span>
<span class="co">#&gt; CLV Transaction Data </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; clvdata(data.transactions = apparelTrans, date.format = "ymd", </span>
<span class="co">#&gt;     time.unit = "week", estimation.split = 40, name.id = "Id", </span>
<span class="co">#&gt;     name.date = "Date", name.price = "Price")</span>
<span class="co">#&gt;                          </span>
<span class="co">#&gt; Total # customers    250 </span>
<span class="co">#&gt; Total # transactions 2257</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                                 </span>
<span class="co">#&gt; Time unit         Weeks         </span>
<span class="co">#&gt;                                 </span>
<span class="co">#&gt; Estimation start  2005-01-03    </span>
<span class="co">#&gt; Estimation end    2005-10-10    </span>
<span class="co">#&gt; Estimation length 40.0000 Weeks </span>
<span class="co">#&gt;                                 </span>
<span class="co">#&gt; Holdout start     2005-10-11    </span>
<span class="co">#&gt; Holdout end       2006-07-16    </span>
<span class="co">#&gt; Holdout length    39.71429 Weeks</span></pre></body></html></div>
<p>Alternatively the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> command provides full detailed summary statistics for the provided transactional detail. <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> is available at any step in the process of estimating a probabilistic customer attrition model with <code>CLVTools</code>. The result output is updated accordingly and additional information is added to the summary statistics.<code><a href="https://rdrr.io/r/stats/nobs.html">nobs()</a></code> extracts the number of observations. For the this particular dataset we observe a total of 250 customers who made in total 2257 repeat purchases. Approximately 26% of the customers are zero repeaters, which means that the only a minority of the customers do not return to the store after their first purchase.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">clv.apparel</span>)
<span class="co">#&gt; CLV Transaction Data </span>
<span class="co">#&gt;                                 </span>
<span class="co">#&gt; Time unit         Weeks         </span>
<span class="co">#&gt; Estimation length 40.0000 Weeks </span>
<span class="co">#&gt; Holdout length    39.71429 Weeks</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Transaction Data Summary </span>
<span class="co">#&gt;                                    Estimation      Holdout         Total     </span>
<span class="co">#&gt; Number of customers                -               -               250       </span>
<span class="co">#&gt; First Transaction in period        2005-01-03      2005-10-11      2005-01-03</span>
<span class="co">#&gt; Last Transaction in period         2005-10-10      2006-07-16      2006-07-16</span>
<span class="co">#&gt; Total # Transactions               1311            946             2257      </span>
<span class="co">#&gt; Mean # Transactions per cust       5.244           8.226           9.028     </span>
<span class="co">#&gt; (SD)                               6.082           8.934           12.603    </span>
<span class="co">#&gt; Mean Spending per Transaction      217.751         226.110         221.254   </span>
<span class="co">#&gt; (SD)                               234.856         247.668         240.290   </span>
<span class="co">#&gt; Total Spending                     285471.100      213899.970      499371.070</span>
<span class="co">#&gt; Total # zero repeaters             77              135             65        </span>
<span class="co">#&gt; Percentage # zero repeaters        0.308           0.540           0.260     </span>
<span class="co">#&gt; Mean Interpurchase time            7.361           5.756           9.462     </span>
<span class="co">#&gt; (SD)                               6.791           6.394           12.266</span></pre></body></html></div>
</div>
<div id="estimate-model-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#estimate-model-parameters" class="anchor"></a>Estimate Model Parameters</h2>
<p>After initializing the object, we are able to estimate the first probabilistic latent attrition model. We start with the standard Pareto/NBD model <span class="citation">(Schmittlein, Morrison, and Colombo 1987)</span> and therefore use the command <code><a href="../reference/pnbd.html">pnbd()</a></code> to fit the model and estimate model parameters. <code>clv.data</code> specifies the initialized object prepared in the last step. Optionally, starting values for the model parameters and control settings for the optimization algorithm may be provided: The argument <code>start.params.model</code> allows to assign a vector (e.g. <code><a href="https://rdrr.io/r/base/c.html">c(alpha=1, beta=2, s=1, beta=2)</a></code> in the case of the Pareto/NBD model) of starting values for the optimization. This is useful if prior knowledge on the parameters of the distributions are available. By default starting values are set to 1 for all parameters. The argument <code>optimx.args</code> provides an option to control settings for the optimization routine. It passes a list of arguments to the optimizer. All options known from the package <code>optimx</code> <span class="citation">(Nash and Varadhan 2011; Nash 2014)</span> may be used. This option enables users to specify specific optimization algorithms, set upper and/or lower limits or enable tracing information on the progress of the optimization. In the case of the standard Pareto/NBD model, <code>CLVTools</code> uses by default the optimization method <code>L-BFGS-G</code> <span class="citation">(Byrd et al. 1995)</span>. If the result of the optimization is in-feasible, the optimization automatically switches to the more robust but often slower <code>Nelder-Mead</code> method <span class="citation">(Nelder and Mead 1965)</span>. <code>verbose</code> shows additional output.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">est.pnbd</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span>(<span class="kw">clv.data</span> <span class="kw">=</span> <span class="no">clv.apparel</span>)
<span class="co">#&gt; Starting estimation...</span>
<span class="co">#&gt; Estimation finished!</span>
<span class="no">est.pnbd</span>
<span class="co">#&gt; Pareto NBD Standard  Model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; pnbd(clv.data = clv.apparel)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;       r    alpha        s     beta  </span>
<span class="co">#&gt;  0.7867   5.3356   0.3574  11.6316  </span>
<span class="co">#&gt; KKT1: TRUE </span>
<span class="co">#&gt; KKT2: TRUE </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Used Options:</span>
<span class="co">#&gt; Correlation:     FALSE</span></pre></body></html></div>
<p>If we assign starting parameters and additional arguments for the optimizer we use:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">est.pnbd</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span>(<span class="kw">clv.data</span> <span class="kw">=</span> <span class="no">clv.apparel</span>,
                     <span class="kw">start.params.model</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">r</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">s</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta</span> <span class="kw">=</span> <span class="fl">2</span>),
                     <span class="kw">optimx.args</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">control</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">trace</span><span class="kw">=</span><span class="fl">5</span>),
                                       <span class="kw">method</span><span class="kw">=</span><span class="st">"Nelder-Mead"</span>,
                                       <span class="kw">upper</span><span class="kw">=</span><span class="kw">NULL</span>,
                                       <span class="kw">lower</span><span class="kw">=</span><span class="kw">NULL</span>))</pre></body></html></div>
<p>Parameter estimates may be reported by either printing the estimated object (i.e. <code>est.pnbd</code>) directly in the console or by calling <code><a href="https://rdrr.io/r/base/summary.html">summary(est.pnbd)</a></code> to get a more detailed report including the likelihood value as well as AIC and BIC. Alternatively parameters may be directly extracted using <code><a href="https://rdrr.io/r/stats/coef.html">coef(est.pnbd)</a></code>. Also <code>loglik()</code>, <code><a href="https://rdrr.io/r/stats/confint.html">confint()</a></code> and <code><a href="https://rdrr.io/r/stats/vcov.html">vcov()</a></code> are available to directly access the Loglikelihood value, confidence intervals for the parameters and to calculate the Variance-Covariance Matrix for the fitted model. For the standard Pareto/NBD model, we get 4 parameters <span class="math inline">\(r, \alpha, s\)</span> and <span class="math inline">\(\beta\)</span>. where <span class="math inline">\(r,\alpha\)</span> represent the shape and scale parameter of the gamma distribution that determines the purchase rate and <span class="math inline">\(s,\beta\)</span> of the attrition rate across individual customers. <span class="math inline">\(r/\alpha\)</span> can be interpreted as the mean purchase and <span class="math inline">\(s/\beta\)</span> as the mean attrition rate. A significance level is provided for each parameter estimates. In the case of the apparelTrans dataset we observe a an average purchase rate of <span class="math inline">\(r/\alpha=0.147\)</span> transactions and an average attrition rate of <span class="math inline">\(s/\beta=0.031\)</span> per customer per week. KKT 1 and 2 indicate the Karush-Kuhn-Tucker optimality conditions of the first and second order <span class="citation">(Kuhn and Tucker 1951)</span>. If those criteria are not met, the optimizer has probably not arrived at an optimal solution. If this is the case it is usually a good idea to rerun the estimation using alternative starting values.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co">#Full detailed summary of the parameter estimates</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">est.pnbd</span>)
<span class="co">#&gt; Pareto NBD Standard  Model </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; pnbd(clv.data = clv.apparel)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fitting period:                               </span>
<span class="co">#&gt; Estimation start  2005-01-03   </span>
<span class="co">#&gt; Estimation end    2005-10-10   </span>
<span class="co">#&gt; Estimation length 40.0000 Weeks</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;       Estimate Std. Error z-val Pr(&gt;|z|)    </span>
<span class="co">#&gt; r       0.7867     0.1324 5.942 2.82e-09 ***</span>
<span class="co">#&gt; alpha   5.3356     0.9028 5.910 3.42e-09 ***</span>
<span class="co">#&gt; s       0.3574     0.1841 1.941   0.0523 .  </span>
<span class="co">#&gt; beta   11.6316    10.6823 1.089   0.2762    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Optimization info:                 </span>
<span class="co">#&gt; LL     -2879.4699</span>
<span class="co">#&gt; AIC    5766.9399 </span>
<span class="co">#&gt; BIC    5781.0257 </span>
<span class="co">#&gt; KKT 1  TRUE      </span>
<span class="co">#&gt; KKT 2  TRUE      </span>
<span class="co">#&gt; fevals 20.0000   </span>
<span class="co">#&gt; Method L-BFGS-B  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Used Options:                 </span>
<span class="co">#&gt; Correlation FALSE</span>

<span class="co">#Extract the coefficients only</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">est.pnbd</span>)
<span class="co">#&gt;          r      alpha          s       beta </span>
<span class="co">#&gt;  0.7866688  5.3355963  0.3573849 11.6316385</span>
<span class="co">#Alternative: oefficients(est.pnbd.obj)</span></pre></body></html></div>
<p>To extract only the coefficients, we can use <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code>. To access the confidence intervals for all parameters <code><a href="https://rdrr.io/r/stats/confint.html">confint()</a></code> is available.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co">#Extract the coefficients only</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">est.pnbd</span>)
<span class="co">#&gt;          r      alpha          s       beta </span>
<span class="co">#&gt;  0.7866688  5.3355963  0.3573849 11.6316385</span>
<span class="co">#Alternative: oefficients(est.pnbd.obj)</span>

<span class="co">#Extrac the confidence intervals</span>
<span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span>(<span class="no">est.pnbd</span>)
<span class="co">#&gt;              2.5 %     97.5 %</span>
<span class="co">#&gt; r      0.527172400  1.0461651</span>
<span class="co">#&gt; alpha  3.566110956  7.1050816</span>
<span class="co">#&gt; s     -0.003526077  0.7182959</span>
<span class="co">#&gt; beta  -9.305344078 32.5686211</span></pre></body></html></div>
<p>In order to get the Likelihood value and the corresponding Variance-Covariance Matrix we use the following commands:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># LogLikelihood at maximum</span>
<span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span>(<span class="no">est.pnbd</span>)
<span class="co">#&gt; 'log Lik.' -2879.47 (df=4)</span>

<span class="co"># Variance-Covariance Matrix at maximum</span>
<span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span>(<span class="no">est.pnbd</span>)
<span class="co">#&gt;                  r      alpha            s        beta</span>
<span class="co">#&gt; r      0.017529372  0.1025851 -0.005632316  -0.5554541</span>
<span class="co">#&gt; alpha  0.102585075  0.8150753 -0.023961502  -2.4694235</span>
<span class="co">#&gt; s     -0.005632316 -0.0239615  0.033908145   1.8589624</span>
<span class="co">#&gt; beta  -0.555454141 -2.4694235  1.858962410 114.1121797</span></pre></body></html></div>
</div>
<div id="predicting-customer-behavior" class="section level2">
<h2 class="hasAnchor">
<a href="#predicting-customer-behavior" class="anchor"></a>Predicting Customer Behavior</h2>
<p>Once the model parameters are estimated, we are able to predict future customer behavior on an individual level. To do so, we use <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> on the object with the estimated parameters (i.e. <code>est.pnbd</code>). The prediction period may be varied by specifying <code>prediction.end</code>. It is possible to provide either an end-date or a duration using the same time unit as specified when initializing the object (i.e <code>prediction.end = "2006-05-08"</code> or <code>prediction.end = 30</code>). By default, the prediction is made until the end of the dataset specified in the <code><a href="../reference/clvdata.html">clvdata()</a></code> command. The argument <code>continuous.discount.factor</code> allows to adjust the discount rate used to estimated the discounted expected transactions (DERT). The default value is <code>0.1</code> (=10%). Probabilistic customer attrition model predict in general three expected characteristics for every customer:</p>
<ul>
<li>“conditional expected transactions” (CET), which is the number of transactions to expect form a customer during the prediction period,</li>
<li>“probability of a customer being alive” (PAlive) at the end of the estimation period and</li>
<li>“discounted expected residual transactions” (DERT) for every customer, which is the total number of transactions for the residual lifetime of a customer discounted to the end of the estimation period.</li>
</ul>
<p>If spending information was provided when initializing the object, <code>CLVTools</code> provides prediction for</p>
<ul>
<li>predicted spending estimated by a Gamma/Gamma model <span class="citation">(Colombo and Jiang 1999; Fader, Hardie, and Lee 2005a)</span> and</li>
<li>the customer lifetime value (CLV).</li>
</ul>
<p>If a holdout period is available additionally the true numbers of transactions (“actual.x”) and true spending (“actual.spendings”) during the holdout period are reported.</p>
<p>To use the parameter estimates on new data (e.g., an other customer cohort), the argument <code>newdata</code> optionally allows to provide a new <code>clvdata</code> object.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">est.pnbd</span>)
<span class="co">#&gt; Predicting from 2005-10-11 until (incl.) 2006-07-16 (39.86 Weeks).</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">results</span>)
<span class="co">#&gt;        Id period.first period.last period.length actual.x actual.spending</span>
<span class="co">#&gt;   1:    1   2005-10-11  2006-07-16      39.85714        0            0.00</span>
<span class="co">#&gt;   2:   10   2005-10-11  2006-07-16      39.85714        0            0.00</span>
<span class="co">#&gt;   3:  100   2005-10-11  2006-07-16      39.85714       23         5086.44</span>
<span class="co">#&gt;   4: 1000   2005-10-11  2006-07-16      39.85714       23         4077.34</span>
<span class="co">#&gt;   5: 1001   2005-10-11  2006-07-16      39.85714       11         2914.10</span>
<span class="co">#&gt;  ---                                                                     </span>
<span class="co">#&gt; 246: 1219   2005-10-11  2006-07-16      39.85714       14         3233.78</span>
<span class="co">#&gt; 247:  122   2005-10-11  2006-07-16      39.85714        0            0.00</span>
<span class="co">#&gt; 248: 1220   2005-10-11  2006-07-16      39.85714        0            0.00</span>
<span class="co">#&gt; 249: 1221   2005-10-11  2006-07-16      39.85714        9         1322.94</span>
<span class="co">#&gt; 250: 1222   2005-10-11  2006-07-16      39.85714        0            0.00</span>
<span class="co">#&gt;         PAlive        CET       DERT predicted.Spending predicted.CLV</span>
<span class="co">#&gt;   1: 0.3571358  0.2212240 0.05848369           216.7955      12.67900</span>
<span class="co">#&gt;   2: 0.4224409  0.9269543 0.24505345           209.1146      51.24426</span>
<span class="co">#&gt;   3: 0.9155010 13.5430229 3.58028916           188.9758     676.58785</span>
<span class="co">#&gt;   4: 0.9967760 13.1755612 3.48314547           171.0913     595.93576</span>
<span class="co">#&gt;   5: 0.5096716  3.5263202 0.93223249           229.8529     214.27636</span>
<span class="co">#&gt;  ---                                                                 </span>
<span class="co">#&gt; 246: 0.9578990  3.6104399 0.95447073           206.0859     196.70295</span>
<span class="co">#&gt; 247: 0.3571358  0.2212240 0.05848369           216.7955      12.67900</span>
<span class="co">#&gt; 248: 0.3571358  0.2212240 0.05848369           216.7955      12.67900</span>
<span class="co">#&gt; 249: 0.9433972  4.2986317 1.13640393           207.0518     235.29447</span>
<span class="co">#&gt; 250: 0.4135069  0.5817466 0.15379292           208.3194      32.03804</span></pre></body></html></div>
<p>To change the duration of the prediction time, we use the <code>predicton.end</code> argument. We can either provide a time period (30 weeks in this example):</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">est.pnbd</span>, <span class="kw">prediction.end</span> <span class="kw">=</span> <span class="fl">30</span>)</pre></body></html></div>
<p>or provide a date indication the end of the prediction period:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">est.pnbd</span>, <span class="kw">prediction.end</span> <span class="kw">=</span> <span class="st">"2006-05-08"</span>)</pre></body></html></div>
</div>
<div id="model-plotting" class="section level2">
<h2 class="hasAnchor">
<a href="#model-plotting" class="anchor"></a>Model Plotting</h2>
<p><code>clvdata</code> objects may be plotted using the <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code> command. Similar to <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>, the output of <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code> adapts on the current modeling step. It provides a descriptive plot of the actual transactional data if the model has not yet been fitted. Once the model has been estimated, <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code> provides an aggregated incremental tracking plot of the actual data and the model based on the estimated parameters. The time-span for the plot may be altered using the <code>prediction.end</code> argument by providing either a duration or an end date. By default the plot is generated for the entire time-span of the provided dataset specified in the <code><a href="../reference/clvdata.html">clvdata()</a></code> command. The dashed line indicates the end of the estimation period. Alternatively cumulative actual and expected transactions can be plotted by setting <code>cumulative</code> to <code>TRUE</code>. The argument <code>transactions</code> disable for plotting actual transactions (<code>transactions=FALSE</code>). For further plotting options see the documentation</p>
<p>plot(x, prediction.end = NULL, cumulative = FALSE, transactions = TRUE, label = NULL, plot = TRUE, verbose = TRUE, …)</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">est.pnbd</span>)
<span class="co">#&gt; Plotting from 2005-01-03 until 2006-07-16.</span></pre></body></html></div>
<p><img src="CLVTools_files/figure-html/plot-model-1.png" width="100%"></p>
<p>To plot the <em>cumulative</em> expected transactions 30 time units (30 weeks in this example) ahead of the end of the estimation plot, we use:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">est.pnbd</span>, <span class="kw">prediction.end</span> <span class="kw">=</span> <span class="fl">30</span>, <span class="kw">cumulative</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>Alternatively, it is possible to specify a date for the <code>prediction.end</code>argument. Note that dates are rounded to the next full time unit (i.e. week):</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">est.pnbd</span>, <span class="kw">prediction.end</span> <span class="kw">=</span> <span class="st">"2006-05-08"</span>, <span class="kw">cumulative</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
</div>
<div id="covariates" class="section level2">
<h2 class="hasAnchor">
<a href="#covariates" class="anchor"></a>Covariates</h2>
<p><code>CLVTools</code> provides the option to include covariates into probabilistic customer attrition models. Covariates may affect the purchase or the attrition process, or both. It is also possible to include different covariates for the two processes. However, support for covariates is dependent on the model. Not all implemented models provide the option for covariates. In general, <code>CLVTools</code> distinguishes between two types of covariates: time-invariant and time-varying. The former include factors that do not change over time such as customer demographics or customer acquisition information. The latter may change over time and include marketing activities or seasonal patterns.</p>
<p>Data for time-invariant covariates must contain a unique customer ID and a single value for each covariate. It should be supplied as a <code>data.frame</code> or <code>data.table</code>. In the example of the apparel retailer we use demographic information “gender” as time-invariant and information on the acquisition channel as covariate for both, the purchase and the attrition process. Use the <code><a href="https://rdrr.io/r/utils/data.html">data("apparelStaticCov")</a></code> command to load the time-invariant covariates. In this example gender is coded as a dummy variable with <code>male=0</code> and <code>female=1</code> and channel with <code>online=0</code> and <code>offline=1</code>.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"apparelStaticCov"</span>)
<span class="no">apparelStaticCov</span>
<span class="co">#&gt;        Id Gender Channel</span>
<span class="co">#&gt;   1:    1      0       0</span>
<span class="co">#&gt;   2:   10      0       0</span>
<span class="co">#&gt;   3:  100      1       0</span>
<span class="co">#&gt;   4: 1000      1       1</span>
<span class="co">#&gt;   5: 1001      1       0</span>
<span class="co">#&gt;  ---                    </span>
<span class="co">#&gt; 246: 1219      0       1</span>
<span class="co">#&gt; 247:  122      0       0</span>
<span class="co">#&gt; 248: 1220      0       0</span>
<span class="co">#&gt; 249: 1221      1       1</span>
<span class="co">#&gt; 250: 1222      1       0</span></pre></body></html></div>
<p>Data for time-varying covariates requires a time-series of covariate values for every customer. I.e. if the time-varying covariates are allowed to change every week, a value for every customer for every week is required. Note that all contextual factors are required to use the same time intervals for the time-series. In the example of the apparel retailer we use information on direct marketing (<code>Marekting</code>) as time-varying covariate. Additionally, we add gender as time-invariant contextual factors. Note that the data structure of invariant covariates needs to be aligned with the structure of time-varying covariate. Use <code><a href="https://rdrr.io/r/utils/data.html">data("apparelDynCov")</a></code> command to load</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"apparelDynCov"</span>)
<span class="no">apparelDynCov</span>
<span class="co">#&gt;          Id   Cov.Date Marketing Gender Channel</span>
<span class="co">#&gt;     1:    1 2004-12-26         1      0       0</span>
<span class="co">#&gt;     2:    1 2005-01-02         1      0       0</span>
<span class="co">#&gt;     3:    1 2005-01-09         0      0       0</span>
<span class="co">#&gt;     4:    1 2005-01-16         1      0       0</span>
<span class="co">#&gt;     5:    1 2005-01-23         2      0       0</span>
<span class="co">#&gt;    ---                                         </span>
<span class="co">#&gt; 20496: 1222 2006-06-18         0      1       0</span>
<span class="co">#&gt; 20497: 1222 2006-06-25         0      1       0</span>
<span class="co">#&gt; 20498: 1222 2006-07-02         0      1       0</span>
<span class="co">#&gt; 20499: 1222 2006-07-09         0      1       0</span>
<span class="co">#&gt; 20500: 1222 2006-07-16         0      1       0</span></pre></body></html></div>
<p>To add the covariates to an initialized <code>clvdata</code> object the commands <code><a href="../reference/SetStaticCovariates.html">SetStaticCovariates()</a></code> and <code><a href="../reference/SetDynamicCovariates.html">SetDynamicCovariates()</a></code> are available. The two commands are mutually exclusive. The argument <code>clv.data</code> specifies the initialized object and the argument <code>data.cov.life</code> respectively <code>data.cov.trans</code> specifies the data source for the covariates for the attrition and the purchase process. Covariates are added separately for the purchase and the attrition process. Therefore if a covariate should affect both processes it has to be added in both arguments: <code>data.cov.life</code> <em>and</em> <code>data.cov.trans</code>. The arguments <code>names.cov.life</code> and <code>names.cov.trans</code> specify the column names of the covariates for the two processes. In our example, we use the same covariates for both processes. Accordingly, we specify the time-invariant covariates “Gender” and “Channel” as follows:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">pnbd.static</span><span class="kw">&lt;-</span> <span class="fu"><a href="../reference/SetStaticCovariates.html">SetStaticCovariates</a></span>(<span class="kw">clv.data</span> <span class="kw">=</span> <span class="no">clv.apparel</span>,
                                      <span class="kw">data.cov.life</span> <span class="kw">=</span> <span class="no">apparelStaticCov</span>,
                                      <span class="kw">data.cov.trans</span> <span class="kw">=</span> <span class="no">apparelStaticCov</span>,
                                      <span class="kw">names.cov.life</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Gender"</span>, <span class="st">"Channel"</span>),
                                      <span class="kw">names.cov.trans</span> <span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Gender"</span>, <span class="st">"Channel"</span>),
                                      <span class="kw">name.id</span> <span class="kw">=</span> <span class="st">"Id"</span>)</pre></body></html></div>
<p>To specify the time-varying contextual factors for seasonal patterns and direct marketing, we use the following:</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">pnbd.dyn</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/SetDynamicCovariates.html">SetDynamicCovariates</a></span>(<span class="kw">clv.data</span> <span class="kw">=</span> <span class="no">clv.apparel</span>,
                                     <span class="kw">data.cov.life</span> <span class="kw">=</span> <span class="no">apparelDynCov</span>,
                                     <span class="kw">data.cov.trans</span> <span class="kw">=</span> <span class="no">apparelDynCov</span>,
                                     <span class="kw">names.cov.life</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Marketing"</span>, <span class="st">"Gender"</span>, <span class="st">"Channel"</span>),
                                     <span class="kw">names.cov.trans</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Marketing"</span>, <span class="st">"Gender"</span>, <span class="st">"Channel"</span>),
                                     <span class="kw">name.id</span> <span class="kw">=</span> <span class="st">"Id"</span>,
                                     <span class="kw">name.date</span> <span class="kw">=</span> <span class="st">"Cov.Date"</span>)</pre></body></html></div>
<p>In order to include time-invariant covariates in a time-varying model, they may be recoded as a time-varying covariate with a constant value in every time period.</p>
<p>Once the covariates are added to the model the estimation process is almost identical to the standard model without covariates. The only difference is that the provided object now data for contains either time-invariant or time-varying covariates and the option to define start parameters for the covariates of both processes using the arguments <code>start.params.life</code> and <code>start.params.trans</code>. If not set, the staring values are set to 1. To define starting parameters for the covariates, the name of the corresponding factor has to be used. For example in the case of time-invariant covariates:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">est.pnbd.static</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span>(<span class="no">pnbd.static</span>,
                         <span class="kw">start.params.model</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">r</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">s</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta</span> <span class="kw">=</span> <span class="fl">2</span>),
                         <span class="kw">start.params.life</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Gender</span><span class="kw">=</span><span class="fl">0.6</span>, <span class="kw">Channel</span><span class="kw">=</span><span class="fl">0.4</span>),
                         <span class="kw">start.params.trans</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Gender</span><span class="kw">=</span><span class="fl">0.6</span>, <span class="kw">Channel</span><span class="kw">=</span><span class="fl">0.4</span>))
<span class="co">#&gt; Starting estimation...</span>
<span class="co">#&gt; Estimation finished!</span></pre></body></html></div>
<p>Analogously, we can estimate the model containing time-varying covariates. We recommend to enable the built-in support for multithreading when estimating more complex models like this. See section <a href="#multithreading">Multitherading</a>.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">est.pnbd.static</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span>(<span class="no">pnbd.dyn</span>,
                         <span class="kw">start.params.model</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">r</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">s</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta</span> <span class="kw">=</span> <span class="fl">2</span>),
                         <span class="kw">start.params.life</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Marketing</span><span class="kw">=</span><span class="fl">0.5</span>, <span class="kw">Gender</span><span class="kw">=</span><span class="fl">0.6</span>, <span class="kw">Channel</span><span class="kw">=</span><span class="fl">0.4</span>),
                         <span class="kw">start.params.trans</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Marketing</span><span class="kw">=</span><span class="fl">0.5</span>, <span class="kw">Gender</span><span class="kw">=</span><span class="fl">0.6</span>, <span class="kw">Channel</span><span class="kw">=</span><span class="fl">0.4</span>))</pre></body></html></div>
<p>To inspect the estimated model we use <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>, however all other commands such as <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code>, <code>loglike()</code>, <code><a href="https://rdrr.io/r/stats/confint.html">confint()</a></code> and <code><a href="https://rdrr.io/r/stats/vcov.html">vcov()</a></code> are also available. Now, output contains also parameters for the covariates for both processes. Since covariates are added separately for the purchase and the attrition process, there are also separate model parameters for the two processes. These parameters are directly interpretable as rate elasticity of the corresponding factors: A 1% change in a contextual factor <span class="math inline">\(\bf{X}^{P}\)</span> or <span class="math inline">\(\bf{X}^{L}\)</span> changes the purchase or the attrition rate by <span class="math inline">\(\gamma_{purch}\bf{X}^{P}\)</span> or <span class="math inline">\(\gamma_{life}\bf{X}^{L}\)</span> percent, respectively <span class="citation">(Gupta 1991)</span>. In the example of the apparel retailer, we observe that female customer purchase significantly more (<code>trans.Gender=1.42576</code>). Note, that female customers are coded as 1, male customers as 0. Also customers acquired offline (coded as Channel=1), purchase more (<code>trans.Channel=0.40304</code>) and stay longer (<code>life.Channel=0.9343</code>). Make sure to check the Karush-Kuhn-Tucker optimality conditions of the first and second order <span class="citation">(Kuhn and Tucker 1951)</span> (KKT1 and KKT1) before interpreting the parameters. If those criteria are not met, the optimizer has probably not arrived at an optimal solution. If this is the case it is usually a good idea to rerun the estimation using alternative starting values.</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">est.pnbd.static</span>)
<span class="co">#&gt; Pareto NBD with Static Covariates  Model </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; pnbd(clv.data = pnbd.static, start.params.model = c(r = 1, alpha = 2, </span>
<span class="co">#&gt;     s = 1, beta = 2), start.params.life = c(Gender = 0.6, Channel = 0.4), </span>
<span class="co">#&gt;     start.params.trans = c(Gender = 0.6, Channel = 0.4))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fitting period:                               </span>
<span class="co">#&gt; Estimation start  2005-01-03   </span>
<span class="co">#&gt; Estimation end    2005-10-10   </span>
<span class="co">#&gt; Estimation length 40.0000 Weeks</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;               Estimate Std. Error  z-val Pr(&gt;|z|)    </span>
<span class="co">#&gt; r              1.41667    0.27716  5.111 3.20e-07 ***</span>
<span class="co">#&gt; alpha         35.68282    8.59835  4.150 3.33e-05 ***</span>
<span class="co">#&gt; s              0.27332    0.09545  2.864  0.00419 ** </span>
<span class="co">#&gt; beta           8.86410   11.60033  0.764  0.44479    </span>
<span class="co">#&gt; life.Gender    1.55102    1.10550  1.403  0.16061    </span>
<span class="co">#&gt; life.Channel  -1.69960    0.66072 -2.572  0.01010 *  </span>
<span class="co">#&gt; trans.Gender   1.42576    0.19786  7.206 5.76e-13 ***</span>
<span class="co">#&gt; trans.Channel  0.40304    0.15127  2.664  0.00771 ** </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Optimization info:                 </span>
<span class="co">#&gt; LL     -2846.1681</span>
<span class="co">#&gt; AIC    5708.3361 </span>
<span class="co">#&gt; BIC    5736.5078 </span>
<span class="co">#&gt; KKT 1  TRUE      </span>
<span class="co">#&gt; KKT 2  TRUE      </span>
<span class="co">#&gt; fevals 62.0000   </span>
<span class="co">#&gt; Method L-BFGS-B  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Used Options:                     </span>
<span class="co">#&gt; Correlation     FALSE</span>
<span class="co">#&gt; Regularization  FALSE</span>
<span class="co">#&gt; Constraint covs FALSE</span></pre></body></html></div>
<p>To predict future customer behavior we use <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code>. Note that dependent on the model, the predicted metrics may differ. For example, in the case of the Pareto/NBD model with time-varying covariates, instead of DERT, DECT is predicted. DECT only covers a finite time horizon in contrast to DERT. Time-varying covariates must be provided for the entire prediction period. If the data initially provided in the <code><a href="../reference/SetDynamicCovariates.html">SetDynamicCovariates()</a></code> command does not cover the complete prediction period, the argument <code>new.data</code> offers the ability to supply new data for the time-varying covariates in the from of a <code>clvdata</code> object.</p>
</div>
<div id="add-correlation-to-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#add-correlation-to-the-model" class="anchor"></a>Add Correlation to the model</h2>
<p>To relax the assumption of independence between the purchase and the attrition process, <code>CLVTools</code> provides the option to specify the argument <code>use.cor</code> in the command t fit the model (i.e. <code>pnbd</code>). In case of <code>use.cor=TRUE</code>, a Sarmanov approach is used to correlate the two processes. <code>start.param.cor</code> allows to optionally specify a starting value for the correlation parameter.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">est.pnbd.cor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span>(<span class="no">clv.apparel</span>,
                     <span class="kw">use.cor</span><span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">est.pnbd.cor</span>)</pre></body></html></div>
<p>The parameter <code>Cor(life,trans)</code> is added to the parameter estimates that may be directly interpreted as a correlation. In the example of the apparel retailer the correlation parameter is not significant and the correlation is very close to zero, indicating that the purchase and the attrition process are independent.</p>
</div>
<div id="advanced-options-for-contextual-factors" class="section level2">
<h2 class="hasAnchor">
<a href="#advanced-options-for-contextual-factors" class="anchor"></a>Advanced Options for Contextual Factors</h2>
<p><code>CLVTools</code> provides two additional estimation options for models containing covariates (time-invariant or time-varying): regularization and constraints for the parameters of the covariates. Both options are included in the command to fit the model (i.e., <code><a href="../reference/pnbd.html">pnbd()</a></code>. Support for this option is dependent on the model. They may be used simultaneously.</p>
<ul>
<li>The argument <code>reg.lambdas</code> provides the possibility to specify separate <code>\lambda_{reg}</code> for the two processes (i.e. <code>reg.lambdas = c(trans=100, life=100)</code>. The larger the <code>\lambda_{reg}</code> the stronger the effects of the regularization. Regularization only affects the parameters of the covariates.</li>
<li>The argument <code>names.cov.constr</code> implements equality constraints for contextual factors with regards to the two processes. For example the variable “gender” is forced to have the same effect on the purchase as well as on the attrition process. To do so, the option <code>names.cov.constr</code> is available (i.e. <code>names.cov.constr=c("Gender")</code>). To provide starting parameters for the constrained variable use <code>start.params.constr</code>.</li>
</ul>
<p>To enable regularization for the covariates, we use the following command:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">est.pnbd.reg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span>(<span class="no">pnbd.static</span>,
                         <span class="kw">start.params.model</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">r</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">s</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta</span> <span class="kw">=</span> <span class="fl">2</span>),
                         <span class="kw">reg.lambdas</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">trans</span><span class="kw">=</span><span class="fl">100</span>, <span class="kw">life</span><span class="kw">=</span><span class="fl">100</span>))
<span class="co">#&gt; Starting estimation...</span>
<span class="co">#&gt; Estimation finished!</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">est.pnbd.reg</span>)
<span class="co">#&gt; Pareto NBD with Static Covariates  Model </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; pnbd(clv.data = pnbd.static, start.params.model = c(r = 1, alpha = 2, </span>
<span class="co">#&gt;     s = 1, beta = 2), reg.lambdas = c(trans = 100, life = 100))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fitting period:                               </span>
<span class="co">#&gt; Estimation start  2005-01-03   </span>
<span class="co">#&gt; Estimation end    2005-10-10   </span>
<span class="co">#&gt; Estimation length 40.0000 Weeks</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                 Estimate Std. Error  z-val Pr(&gt;|z|)</span>
<span class="co">#&gt; r              7.928e-01  2.117e+00  0.375    0.708</span>
<span class="co">#&gt; alpha          5.393e+00  1.443e+01  0.374    0.709</span>
<span class="co">#&gt; s              3.603e-01  2.946e+00  0.122    0.903</span>
<span class="co">#&gt; beta           1.176e+01  1.711e+02  0.069    0.945</span>
<span class="co">#&gt; life.Gender   -2.448e-05  1.712e-02 -0.001    0.999</span>
<span class="co">#&gt; life.Channel  -1.163e-04  1.712e-02 -0.007    0.995</span>
<span class="co">#&gt; trans.Gender   5.391e-04  1.712e-02  0.031    0.975</span>
<span class="co">#&gt; trans.Channel  4.498e-04  1.712e-02  0.026    0.979</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Optimization info:               </span>
<span class="co">#&gt; LL     -11.5178</span>
<span class="co">#&gt; AIC    39.0357 </span>
<span class="co">#&gt; BIC    67.2074 </span>
<span class="co">#&gt; KKT 1  TRUE    </span>
<span class="co">#&gt; KKT 2  TRUE    </span>
<span class="co">#&gt; fevals 194.0000</span>
<span class="co">#&gt; Method L-BFGS-B</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Used Options:                        </span>
<span class="co">#&gt; Correlation     FALSE   </span>
<span class="co">#&gt; Regularization  TRUE    </span>
<span class="co">#&gt;    lambda.life  100.0000</span>
<span class="co">#&gt;    lambda.trans 100.0000</span>
<span class="co">#&gt; Constraint covs FALSE</span></pre></body></html></div>
<p>To constrain “Gender” to have the same effect on both processes we use the following command. Note, that the output now only contains one parameter for “Gender” as it is constrained to be the same for both processes.</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">est.pnbd.constr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pnbd.html">pnbd</a></span>(<span class="no">pnbd.static</span>,
                         <span class="kw">start.params.model</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">r</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">s</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">beta</span> <span class="kw">=</span> <span class="fl">2</span>),
                         <span class="kw">start.params.constr</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">Gender</span><span class="kw">=</span><span class="fl">0.6</span>),
                         <span class="kw">names.cov.constr</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Gender"</span>))
<span class="co">#&gt; Starting estimation...</span>
<span class="co">#&gt; Estimation finished!</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">est.pnbd.constr</span>)
<span class="co">#&gt; Pareto NBD with Static Covariates  Model </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; pnbd(clv.data = pnbd.static, start.params.model = c(r = 1, alpha = 2, </span>
<span class="co">#&gt;     s = 1, beta = 2), names.cov.constr = c("Gender"), start.params.constr = c(Gender = 0.6))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fitting period:                               </span>
<span class="co">#&gt; Estimation start  2005-01-03   </span>
<span class="co">#&gt; Estimation end    2005-10-10   </span>
<span class="co">#&gt; Estimation length 40.0000 Weeks</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;               Estimate Std. Error  z-val Pr(&gt;|z|)    </span>
<span class="co">#&gt; r              1.42323    0.27536  5.169 2.36e-07 ***</span>
<span class="co">#&gt; alpha         35.45252    8.37875  4.231 2.32e-05 ***</span>
<span class="co">#&gt; s              0.27408    0.09527  2.877  0.00402 ** </span>
<span class="co">#&gt; beta           7.87475    7.67175  1.026  0.30467    </span>
<span class="co">#&gt; life.Channel  -1.68821    0.64231 -2.628  0.00858 ** </span>
<span class="co">#&gt; trans.Channel  0.40185    0.15102  2.661  0.00779 ** </span>
<span class="co">#&gt; constr.Gender  1.41567    0.18405  7.692 1.44e-14 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Optimization info:                 </span>
<span class="co">#&gt; LL     -2846.1729</span>
<span class="co">#&gt; AIC    5706.3458 </span>
<span class="co">#&gt; BIC    5730.9960 </span>
<span class="co">#&gt; KKT 1  TRUE      </span>
<span class="co">#&gt; KKT 2  TRUE      </span>
<span class="co">#&gt; fevals 39.0000   </span>
<span class="co">#&gt; Method L-BFGS-B  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Used Options:                           </span>
<span class="co">#&gt; Correlation          FALSE </span>
<span class="co">#&gt; Regularization       FALSE </span>
<span class="co">#&gt; Constraint covs      TRUE  </span>
<span class="co">#&gt;    Constraint params Gender</span></pre></body></html></div>
</div>
<div id="multithreading" class="section level2">
<h2 class="hasAnchor">
<a href="#multithreading" class="anchor"></a>Multithreading: Enable parallel processing for CLVTools</h2>
<p><code>CLVTools</code> supports parallel processing when estimating models containing time-varying covariates using the package <code>future</code> <span class="citation">(Bengtsson 2020b)</span> and the corresponding <code>foreach</code> <span class="citation">(Microsoft and Weston 2019)</span> parallel adapter <code>doFuture</code> <span class="citation">(Bengtsson 2020a)</span>. To enable the distribution of the workload across all available cores, use execute the following commands before estimating the model (i.e. calling `pnbd()):</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r">  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"doFuture"</span>)
  <span class="fu"><a href="https://rdrr.io/pkg/doFuture/man/registerDoFuture.html">registerDoFuture</a></span>()
  <span class="fu">plan</span>(<span class="st">"multisession"</span>)</pre></body></html></div>
<p>To limit the number of parallel processes simultaneously executed, we can specify the number of workers <code>plan(multisession, workers = 2)</code>.</p>
<div id="literature" class="section level3 unnumbered">
<h3 class="hasAnchor">
<a href="#literature" class="anchor"></a>Literature</h3>
<div id="refs" class="references">
<div id="ref-doFuture">
<p>Bengtsson, Henrik. 2020a. <em>DoFuture: A Universal Foreach Parallel Adapter Using the Future Api of the ’Future’ Package</em>. <a href="https://CRAN.R-project.org/package=doFuture">https://CRAN.R-project.org/package=doFuture</a>.</p>
</div>
<div id="ref-future">
<p>———. 2020b. <em>Future: Unified Parallel and Distributed Processing in R for Everyone</em>. <a href="https://CRAN.R-project.org/package=future">https://CRAN.R-project.org/package=future</a>.</p>
</div>
<div id="ref-byrd1995limited">
<p>Byrd, Richard H, Peihuang Lu, Jorge Nocedal, and Ciyou Zhu. 1995. “A Limited Memory Algorithm for Bound Constrained Optimization.” <em>SIAM Journal on Scientific Computing</em> 16 (5): 1190–1208.</p>
</div>
<div id="ref-Colombo1999">
<p>Colombo, Richard, and Weina Jiang. 1999. “A stochastic RFM model.” <em>Journal of Interactive Marketing</em> 13 (3): 2–12.</p>
</div>
<div id="ref-data-table">
<p>Dowle, Matt, and Arun Srinivasan. 2019. <em>Data.table: Extension of ’Data.frame’</em>. <a href="https://CRAN.R-project.org/package=data.table">https://CRAN.R-project.org/package=data.table</a>.</p>
</div>
<div id="ref-Fader2005c">
<p>Fader, Peter S., Bruce G. S. Hardie, and KL Lee. 2005a. “’Counting Your Customers’ the Easy Way: An Alternative to the Pareto/NBD Model.” <em>Marketing Science</em> 24 (2): 275–84.</p>
</div>
<div id="ref-Fader2005b">
<p>———. 2005b. “RFM and CLV: Using Iso-Value Curves for Customer Base Analysis.” <em>Journal of Marketing Research</em> 42 (4): 415–30.</p>
</div>
<div id="ref-lubridate">
<p>Grolemund, Garrett, and Hadley Wickham. 2011. “Dates and Times Made Easy with lubridate.” <em>Journal of Statistical Software</em> 40 (3): 1–25. <a href="http://www.jstatsoft.org/v40/i03/">http://www.jstatsoft.org/v40/i03/</a>.</p>
</div>
<div id="ref-Gupta1991">
<p>Gupta, Sunil. 1991. “Stochastic Models of Interpurchase Time with Time-Dependent Covariates.” <em>Journal of Marketing Research</em> 28 (1): 1–15.</p>
</div>
<div id="ref-KKT">
<p>Kuhn, H. W., and A. W. Tucker. 1951. “Nonlinear Programming.” In <em>Second Berkeley Symposium on Mathematical Statistics and Probability</em>, edited by J. Neyman, 481–92.</p>
</div>
<div id="ref-foreach">
<p>Microsoft, and Steve Weston. 2019. <em>Foreach: Provides Foreach Looping Construct</em>. <a href="https://CRAN.R-project.org/package=foreach">https://CRAN.R-project.org/package=foreach</a>.</p>
</div>
<div id="ref-optimx2">
<p>Nash, John C. 2014. “On Best Practice Optimization Methods in R.” <em>Journal of Statistical Software</em> 60 (2): 1–14. <a href="http://www.jstatsoft.org/v60/i02/">http://www.jstatsoft.org/v60/i02/</a>.</p>
</div>
<div id="ref-optimx1">
<p>Nash, John C., and Ravi Varadhan. 2011. “Unifying Optimization Algorithms to Aid Software System Users: optimx for R.” <em>Journal of Statistical Software</em> 43 (9): 1–14. <a href="http://www.jstatsoft.org/v43/i09/">http://www.jstatsoft.org/v43/i09/</a>.</p>
</div>
<div id="ref-nelder1965simplex">
<p>Nelder, John A, and Roger Mead. 1965. “A Simplex Method for Function Minimization.” <em>The Computer Journal</em> 7 (4): 308–13.</p>
</div>
<div id="ref-Schmittlein1987">
<p>Schmittlein, David C., Donald G. Morrison, and Richard Colombo. 1987. “Counting Your Customers: Who-Are They and What Will They Do Next?” <em>Management Science</em> 33 (1): 1–24.</p>
</div>
<div id="ref-devtools">
<p>Wickham, Hadley, Jim Hester, and Winston Chang. 2019. <em>Devtools: Tools to Make Developing R Packages Easier</em>. <a href="https://CRAN.R-project.org/package=devtools">https://CRAN.R-project.org/package=devtools</a>.</p>
</div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Patrick Bachmann, Jeffrey Naef, Patrik Schilter, Markus Meierer, Niels Kuebler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
