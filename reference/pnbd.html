<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Pareto/NBD models — pnbd • CLVTools</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Pareto/NBD models — pnbd" />
<meta property="og:description" content="Fits Pareto/NBD models on transactional data with and without covariates." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-31477052-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-31477052-2');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CLVTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/CLVTools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/internal_docu/internal_docu.html">Internal Package Documentation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bachmannpatrick/CLVTools/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Pareto/NBD models</h1>
    <small class="dont-index">Source: <a href='https://github.com/bachmannpatrick/CLVTools/blob/master/R/f_interface_pnbd.R'><code>R/f_interface_pnbd.R</code></a></small>
    <div class="hidden name"><code>pnbd.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits Pareto/NBD models on transactional data with and without covariates.</p>
    </div>

    <pre class="usage"><span class='co'># S4 method for clv.data</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(
  <span class='kw'>clv.data</span>,
  start.params.model = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  use.cor = <span class='fl'>FALSE</span>,
  start.param.cor = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  optimx.args = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  verbose = <span class='fl'>TRUE</span>,
  <span class='kw'>...</span>
)

<span class='co'># S4 method for clv.data.static.covariates</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(
  <span class='kw'>clv.data</span>,
  start.params.model = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  use.cor = <span class='fl'>FALSE</span>,
  start.param.cor = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  optimx.args = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  verbose = <span class='fl'>TRUE</span>,
  names.cov.life = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  names.cov.trans = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  start.params.life = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  start.params.trans = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  names.cov.constr = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  start.params.constr = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  reg.lambdas = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  <span class='kw'>...</span>
)

<span class='co'># S4 method for clv.data.dynamic.covariates</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(
  <span class='kw'>clv.data</span>,
  start.params.model = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  use.cor = <span class='fl'>FALSE</span>,
  start.param.cor = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  optimx.args = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  verbose = <span class='fl'>TRUE</span>,
  names.cov.life = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  names.cov.trans = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  start.params.life = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  start.params.trans = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  names.cov.constr = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  start.params.constr = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  reg.lambdas = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(),
  <span class='kw'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>clv.data</th>
      <td><p>The data object on which the model is fitted.</p></td>
    </tr>
    <tr>
      <th>start.params.model</th>
      <td><p>Named start parameters containing the optimization start parameters for the model without covariates.</p></td>
    </tr>
    <tr>
      <th>use.cor</th>
      <td><p>Whether the correlation between the transaction and lifetime process should be estimated.</p></td>
    </tr>
    <tr>
      <th>start.param.cor</th>
      <td><p>Start parameter for the optimization of the correlation.</p></td>
    </tr>
    <tr>
      <th>optimx.args</th>
      <td><p>Additional arguments to control the optimization which are forwarded to <code><a href='https://rdrr.io/pkg/optimx/man/optimx.html'>optimx::optimx</a></code>.
If multiple optimization methods are specified, only the result of the last method is further processed.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Show details about the running of the function.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Ignored</p></td>
    </tr>
    <tr>
      <th>names.cov.life</th>
      <td><p>Which of the set Lifetime covariates should be used. Missing parameter indicates all covariates shall be used.</p></td>
    </tr>
    <tr>
      <th>names.cov.trans</th>
      <td><p>Which of the set Transaction covariates should be used. Missing parameter indicates all covariates shall be used.</p></td>
    </tr>
    <tr>
      <th>start.params.life</th>
      <td><p>Named start parameters containing the optimization start parameters for all lifetime covariates.</p></td>
    </tr>
    <tr>
      <th>start.params.trans</th>
      <td><p>Named start parameters containing the optimization start parameters for all transaction covariates.</p></td>
    </tr>
    <tr>
      <th>names.cov.constr</th>
      <td><p>Which covariates should be forced to use the same parameters for the lifetime and transaction process. The covariates need to be present as both, lifetime and transaction covariates.</p></td>
    </tr>
    <tr>
      <th>start.params.constr</th>
      <td><p>Named start parameters containing the optimization start parameters for the constraint covariates.</p></td>
    </tr>
    <tr>
      <th>reg.lambdas</th>
      <td><p>Named lambda parameters used for the L2 regularization of the lifetime and the transaction covariate parameters. Lambdas have to be &gt;= 0.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Depending on the data object on which the model was fit, <code>pnbd</code> returns either an object of
class <a href='https://rdrr.io/pkg/CLVTools/man/clv.pnbd-class.html'>clv.pnbd</a>, <a href='https://rdrr.io/pkg/CLVTools/man/clv.pnbd.static.cov-class.html'>clv.pnbd.static.cov</a>, or <a href='https://rdrr.io/pkg/CLVTools/man/clv.pnbd.dynamic.cov-class.html'>clv.pnbd.dynamic.cov</a>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Model parameters for the Pareto/NBD model are <code>alpha, r, beta, and s</code>. <br />
<code>s</code>: shape parameter of the Gamma distribution for the lifetime process.
The smaller s, the stronger the heterogeneity of customer lifetimes. <br />
<code>beta</code>: scale parameter for the Gamma distribution for the lifetime process. <br />
<code>r</code>: shape parameter of the Gamma distribution of the purchase process.
The smaller r, the stronger the heterogeneity of the purchase process.<br />
<code>alpha</code>: scale parameter of the Gamma distribution of the purchase process.</p>
<p>Ideally, the starting parameters for r and s represent your best guess
concerning the heterogeneity of customers in their buy and die rate.
If covariates are included into the model additionally parameters for the
covariates affecting the attrition and the purchase process are part of the model.</p>
<p>If no start parameters are given, 1.0 is used for all model parameters and 0.1 for covariate parameters.
The model start parameters are required to be &gt; 0.</p>
<h3>The Pareto/NBD model</h3>
<p>The Pareto/NBD is the first model addressing the issue of modeling customer purchases and
attrition simultaneously for non-contractual settings. The model uses a Pareto distribution,
a combination of an Exponential and a Gamma distribution, to explicitly model customers'
(unobserved) attrition behavior in addition to customers' purchase process.<br />
In general, the Pareto/NBD model consist of two parts. A first process models the purchase
behavior of customers as long as the customers are active. A second process models customers'
attrition. Customers live (and buy) for a certain unknown time until they become inactive
and "die". Customer attrition is unobserved. Inactive customers may not be reactivated.
For technical details we refer to the original paper by Schmittlein, Morrison and Colombo
(1987) and the detailed technical note of Fader and Hardie (2005).</p>

<h3>Pareto/NBD model with static covariates</h3>
<p>The standard Pareto/NBD model captures heterogeneity was solely using Gamma distributions.
However, often exogenous knowledge, such as for example customer demographics, is available.
The supplementary knowledge may explain part of the heterogeneity among the customers and
therefore increase the predictive accuracy of the model. In addition, we can rely on these
parameter estimates for inference, i.e. identify and quantify effects of contextual factors
on the two underlying purchase and attrition processes. For technical details we refer to
the technical note by Fader and Hardie (2007).</p>

<h3>Pareto/NBD model with dynamic covariates</h3>
<p>In many real-world applications customer purchase and attrition behavior may be
influenced by covariates that vary over time. In consequence, the timing of a purchase
and the corresponding value of at covariate a that time becomes relevant. Time-varying
covariates can affect customer on aggregated level as well as on an individual level:
In the first case, all customers are affected simultaneously, in the latter case a
covariate is only relevant for a particular customer. For technical details we refer to
the paper by Bachmann, Meierer and Näf (2020).</p>

    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Fitting the Pareto/NBD model with dynamic covariates is for the most part implemented using <code>data.table</code> and to a smaller part further
parallelized with the <code>foreach</code> package. Registering a
parallel backend with <code><a href='https://rdrr.io/pkg/doFuture/man/doFuture.html'>doFuture</a></code> or <code><a href='https://rdrr.io/pkg/doParallel/man/doParallel-package.html'>doParallel</a></code> before fitting the
models allows to take advantage of this. If no parallel backend is set up, the <code>foreach</code> package gives a friendly reminder that
it is executed sequentially. In case this is desired but no warning should be given, a parallel backend in sequential mode
can be set up, for example package <code>doFuture</code> with <code><a href='https://rdrr.io/pkg/future/man/plan.html'>plan("sequential")</a></code>.</p>
<p>The part executed with <code>foreach</code> also heavily relies on <code>data.table</code> which is natively parallelized already. When setting up
the parallel backend, great care should be taken to reduce the overhead from this nested parallelism as otherwise it can <em>increase</em> runtime.
See <code>setDTthreads</code>, <code>getDTthreads</code>,
and <code><a href='https://rdrr.io/pkg/future/man/plan.html'>plan</a></code> for information on how to do this.</p>
<p>The Pareto/NBD model with dynamic covariates can currently not be fit with data that has a temporal resolution
of less than one day (data that was built with time unit <code>hours</code>).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Schmittlein DC, Morrison DG, Colombo R (1987). &#8220;Counting Your Customers:
Who-Are They and What Will They Do Next?&#8221; Management Science, 33(1), 1–24.</p>
<p>Fader PS, Hardie BGS (2005). &#8220;A Note on Deriving the Pareto/NBD Model and
Related Expressions.&#8221;
URL <a href='http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf'>http://www.brucehardie.com/notes/009/pareto_nbd_derivations_2005-11-05.pdf</a>.</p>
<p>Fader PS, Hardie BG (2007). &#8220;Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.&#8221;
URL <a href='http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf'>http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/pkg/CLVTools/man/clvdata.html'>clvdata</a></code> to create a clv data object, <code><a href='https://rdrr.io/pkg/CLVTools/man/SetStaticCovariates.html'>SetStaticCovariates</a></code>
to add static covariates to an existing clv data object.</p>
<p><code><a href='https://rdrr.io/pkg/CLVTools/man/predict.clv.fitted.html'>predict</a></code> to predict expected transactions, probability of being alive, and customer lifetime value for every customer</p>
<p><code><a href='https://rdrr.io/pkg/CLVTools/man/plot.clv.fitted.html'>plot</a></code> to plot the unconditional expectation as predicted by the fitted model</p>
<p>The generic functions <code><a href='https://rdrr.io/pkg/CLVTools/man/vcov.clv.fitted.html'>vcov</a></code>, <code><a href='https://rdrr.io/pkg/CLVTools/man/summary.clv.fitted.html'>summary</a></code>, <code><a href='https://rdrr.io/pkg/CLVTools/man/fitted.clv.fitted.html'>fitted</a></code>.</p>
<p><code><a href='https://rdrr.io/pkg/CLVTools/man/SetDynamicCovariates.html'>SetDynamicCovariates</a></code> to add dynamic covariates on which the <code>pnbd</code> model can be fit.</p>
<p><code>setDTthreads</code>, <code>getDTthreads</code>,<code><a href='https://rdrr.io/pkg/doParallel/man/registerDoParallel.html'>registerDoParallel</a></code>,<code><a href='https://rdrr.io/pkg/doFuture/man/registerDoFuture.html'>registerDoFuture</a></code> for setting up parallel execution.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"apparelTrans"</span>)
<span class='kw'>clv.data.apparel</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/clvdata.html'>clvdata</a></span>(<span class='kw'>apparelTrans</span>, date.format = <span class='st'>"ymd"</span>,
                            time.unit = <span class='st'>"w"</span>, estimation.split = <span class='fl'>40</span>)

<span class='co'># Fit standard pnbd model</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(<span class='kw'>clv.data.apparel</span>)</div><div class='output co'>#&gt; <span class='message'>Starting estimation...</span></div><div class='output co'>#&gt; <span class='message'>Estimation finished!</span></div><div class='output co'>#&gt; Pareto NBD Standard  Model
#&gt; 
#&gt; Call:
#&gt; pnbd(clv.data = clv.data.apparel)
#&gt; 
#&gt; Coefficients:
#&gt;       r    alpha        s     beta  
#&gt;  0.7867   5.3356   0.3574  11.6316  
#&gt; KKT1: TRUE 
#&gt; KKT2: TRUE 
#&gt; 
#&gt; Used Options:
#&gt; Correlation:     FALSE </div><div class='input'>
<span class='co'># Give initial guesses for the Model parameters</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(<span class='kw'>clv.data.apparel</span>,
     start.params.model = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(r=<span class='fl'>0.5</span>, alpha=<span class='fl'>15</span>, s=<span class='fl'>0.5</span>, beta=<span class='fl'>10</span>))</div><div class='output co'>#&gt; <span class='message'>Starting estimation...</span></div><div class='output co'>#&gt; <span class='message'>Estimation finished!</span></div><div class='output co'>#&gt; Pareto NBD Standard  Model
#&gt; 
#&gt; Call:
#&gt; pnbd(clv.data = clv.data.apparel, start.params.model = c(r = 0.5, 
#&gt;     alpha = 15, s = 0.5, beta = 10))
#&gt; 
#&gt; Coefficients:
#&gt;       r    alpha        s     beta  
#&gt;  0.7858   5.3312   0.3606  11.8221  
#&gt; KKT1: TRUE 
#&gt; KKT2: TRUE 
#&gt; 
#&gt; Used Options:
#&gt; Correlation:     FALSE </div><div class='input'>

<span class='co'># pass additional parameters to the optimizer (optimx)</span>
<span class='co'>#    Use Nelder-Mead as optimization method and print</span>
<span class='co'>#    detailed information about the optimization process</span>
<span class='kw'>apparel.pnbd</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(<span class='kw'>clv.data.apparel</span>,
                     optimx.args = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(method=<span class='st'>"Nelder-Mead"</span>,
                                        control=<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(trace=<span class='fl'>6</span>)))</div><div class='output co'>#&gt; <span class='message'>Starting estimation...</span></div><div class='output co'>#&gt; fn is  fn 
#&gt; Looking for method =  Nelder-Mead 
#&gt; Methods to be used:[1] "Nelder-Mead"
#&gt; optcfg:$fname
#&gt; [1] "fn"
#&gt; 
#&gt; $npar
#&gt; [1] 4
#&gt; 
#&gt; $ctrl
#&gt; $ctrl$follow.on
#&gt; [1] FALSE
#&gt; 
#&gt; $ctrl$save.failures
#&gt; [1] TRUE
#&gt; 
#&gt; $ctrl$trace
#&gt; [1] 6
#&gt; 
#&gt; $ctrl$kkt
#&gt; [1] TRUE
#&gt; 
#&gt; $ctrl$all.methods
#&gt; [1] FALSE
#&gt; 
#&gt; $ctrl$starttests
#&gt; [1] FALSE
#&gt; 
#&gt; $ctrl$maximize
#&gt; [1] FALSE
#&gt; 
#&gt; $ctrl$dowarn
#&gt; [1] TRUE
#&gt; 
#&gt; $ctrl$usenumDeriv
#&gt; [1] FALSE
#&gt; 
#&gt; $ctrl$kkttol
#&gt; [1] 0.001
#&gt; 
#&gt; $ctrl$kkt2tol
#&gt; [1] 1e-06
#&gt; 
#&gt; $ctrl$badval
#&gt; [1] 8.988466e+307
#&gt; 
#&gt; $ctrl$scaletol
#&gt; [1] 3
#&gt; 
#&gt; $ctrl$have.bounds
#&gt; [1] FALSE
#&gt; 
#&gt; 
#&gt; $usenumDeriv
#&gt; [1] FALSE
#&gt; 
#&gt; $ufn
#&gt; function (LL.params, LL.function.sum, use.interlayer.constr, 
#&gt;     use.interlayer.reg, reg.lambda.trans, reg.lambda.life, use.cor, 
#&gt;     ...) 
#&gt; {
#&gt;     all.other.args &lt;- list(...)
#&gt;     interlayers.to.use &lt;- list(callLL = interlayer_callLL)
#&gt;     if (use.cor == T &amp; !anyNA(use.cor)) 
#&gt;         interlayers.to.use &lt;- c(correlation = interlayer_correlation, 
#&gt;             interlayers.to.use)
#&gt;     if (use.interlayer.reg == T &amp; !is.null(reg.lambda.trans) &amp; 
#&gt;         !anyNA(reg.lambda.trans) &amp; !is.null(reg.lambda.life) &amp; 
#&gt;         !anyNA(reg.lambda.life)) {
#&gt;         interlayers.to.use &lt;- c(regularization = interlayer_regularization, 
#&gt;             interlayers.to.use)
#&gt;     }
#&gt;     if (use.interlayer.constr == TRUE) {
#&gt;         interlayers.to.use &lt;- c(constraints = interlayer_constraints, 
#&gt;             interlayers.to.use)
#&gt;     }
#&gt;     interlayer.call.args &lt;- list(next.interlayers = interlayers.to.use, 
#&gt;         LL.function.sum = LL.function.sum, LL.params = LL.params, 
#&gt;         reg.lambda.life = reg.lambda.life, reg.lambda.trans = reg.lambda.trans)
#&gt;     interlayer.call.args &lt;- modifyList(interlayer.call.args, 
#&gt;         all.other.args)
#&gt;     return(do.call(what = interlayer_callnextinterlayer, args = interlayer.call.args))
#&gt; }
#&gt; &lt;bytecode: 0x7fe34ced29e8&gt;
#&gt; &lt;environment: namespace:CLVTools&gt;
#&gt; 
#&gt; $have.bounds
#&gt; [1] FALSE
#&gt; 
#&gt; $method
#&gt; [1] "Nelder-Mead"
#&gt; 
#&gt; Method:  Nelder-Mead 
#&gt;   Nelder-Mead direct search function minimizer
#&gt; function value for initial parameters = 3322.356869
#&gt;   Scaled convergence tolerance is 4.9507e-05
#&gt; Stepsize computed as 0.100000
#&gt; BUILD              5 3369.036239 3309.338871
#&gt; EXTENSION          7 3348.164879 3244.722352
#&gt; LO-REDUCTION       9 3322.356869 3244.722352
#&gt; EXTENSION         11 3311.326140 3190.793764
#&gt; EXTENSION         13 3309.338871 3136.995127
#&gt; EXTENSION         15 3244.970943 3070.661973
#&gt; LO-REDUCTION      17 3244.722352 3070.661973
#&gt; EXTENSION         19 3190.793764 2962.711423
#&gt; LO-REDUCTION      21 3136.995127 2962.711423
#&gt; LO-REDUCTION      23 3092.779244 2962.711423
#&gt; EXTENSION         25 3070.661973 2904.899192
#&gt; EXTENSION         27 2979.692293 2901.790592
#&gt; REFLECTION        29 2971.137892 2896.215344
#&gt; LO-REDUCTION      31 2962.711423 2890.642122
#&gt; LO-REDUCTION      33 2906.533400 2890.642122
#&gt; LO-REDUCTION      35 2904.899192 2890.642122
#&gt; HI-REDUCTION      37 2901.790592 2890.642122
#&gt; LO-REDUCTION      39 2896.854291 2890.642122
#&gt; LO-REDUCTION      41 2896.733398 2890.642122
#&gt; LO-REDUCTION      43 2896.215344 2890.642122
#&gt; EXTENSION         45 2895.169640 2884.464824
#&gt; LO-REDUCTION      47 2891.545912 2884.464824
#&gt; LO-REDUCTION      49 2890.755169 2884.464824
#&gt; EXTENSION         51 2890.642122 2882.953045
#&gt; REFLECTION        53 2888.700681 2882.446051
#&gt; LO-REDUCTION      55 2884.570203 2882.446051
#&gt; HI-REDUCTION      57 2884.464824 2882.446051
#&gt; LO-REDUCTION      59 2883.270678 2882.446051
#&gt; HI-REDUCTION      61 2882.953045 2882.396690
#&gt; HI-REDUCTION      63 2882.895319 2882.314190
#&gt; HI-REDUCTION      65 2882.482512 2882.248928
#&gt; HI-REDUCTION      67 2882.446051 2882.248928
#&gt; HI-REDUCTION      69 2882.396690 2882.240024
#&gt; LO-REDUCTION      71 2882.314190 2882.191572
#&gt; LO-REDUCTION      73 2882.251157 2882.163573
#&gt; LO-REDUCTION      75 2882.248928 2882.163573
#&gt; HI-REDUCTION      77 2882.240024 2882.163573
#&gt; HI-REDUCTION      79 2882.191572 2882.162231
#&gt; HI-REDUCTION      81 2882.167468 2882.140209
#&gt; LO-REDUCTION      83 2882.166824 2882.140209
#&gt; HI-REDUCTION      85 2882.163573 2882.140209
#&gt; LO-REDUCTION      87 2882.162231 2882.138172
#&gt; REFLECTION        89 2882.144473 2882.137304
#&gt; LO-REDUCTION      91 2882.141601 2882.135061
#&gt; HI-REDUCTION      93 2882.140209 2882.132257
#&gt; REFLECTION        95 2882.138172 2882.129096
#&gt; EXTENSION         97 2882.137304 2882.117858
#&gt; LO-REDUCTION      99 2882.135061 2882.117858
#&gt; LO-REDUCTION     101 2882.132257 2882.117858
#&gt; EXTENSION        103 2882.129096 2882.106725
#&gt; EXTENSION        105 2882.126478 2882.091916
#&gt; LO-REDUCTION     107 2882.119912 2882.091916
#&gt; LO-REDUCTION     109 2882.117858 2882.091916
#&gt; EXTENSION        111 2882.106725 2882.071824
#&gt; LO-REDUCTION     113 2882.104616 2882.071824
#&gt; EXTENSION        115 2882.099252 2882.044612
#&gt; EXTENSION        117 2882.091916 2882.012574
#&gt; LO-REDUCTION     119 2882.079287 2882.012574
#&gt; EXTENSION        121 2882.071824 2881.969055
#&gt; EXTENSION        123 2882.044612 2881.898069
#&gt; LO-REDUCTION     125 2882.032117 2881.898069
#&gt; EXTENSION        127 2882.012574 2881.780423
#&gt; LO-REDUCTION     129 2881.969055 2881.780423
#&gt; EXTENSION        131 2881.918692 2881.640737
#&gt; LO-REDUCTION     133 2881.898069 2881.640737
#&gt; EXTENSION        135 2881.809312 2881.425073
#&gt; LO-REDUCTION     137 2881.780423 2881.425073
#&gt; EXTENSION        139 2881.647928 2881.303066
#&gt; EXTENSION        141 2881.640737 2881.229749
#&gt; REFLECTION       143 2881.430767 2881.166043
#&gt; LO-REDUCTION     145 2881.425073 2881.166043
#&gt; HI-REDUCTION     147 2881.303066 2881.166043
#&gt; EXTENSION        149 2881.279120 2881.119888
#&gt; EXTENSION        151 2881.277302 2881.042370
#&gt; LO-REDUCTION     153 2881.229749 2881.042370
#&gt; EXTENSION        155 2881.166043 2880.967832
#&gt; EXTENSION        157 2881.119888 2880.879994
#&gt; LO-REDUCTION     159 2881.087359 2880.879994
#&gt; REFLECTION       161 2881.042370 2880.879853
#&gt; LO-REDUCTION     163 2880.967832 2880.879853
#&gt; LO-REDUCTION     165 2880.901343 2880.879853
#&gt; HI-REDUCTION     167 2880.882262 2880.869537
#&gt; REFLECTION       169 2880.881546 2880.868296
#&gt; REFLECTION       171 2880.879994 2880.855871
#&gt; HI-REDUCTION     173 2880.879853 2880.854640
#&gt; HI-REDUCTION     175 2880.869537 2880.854640
#&gt; EXTENSION        177 2880.868296 2880.818013
#&gt; LO-REDUCTION     179 2880.857420 2880.818013
#&gt; LO-REDUCTION     181 2880.855871 2880.818013
#&gt; LO-REDUCTION     183 2880.854640 2880.818013
#&gt; EXTENSION        185 2880.842474 2880.781988
#&gt; LO-REDUCTION     187 2880.842315 2880.781988
#&gt; LO-REDUCTION     189 2880.832743 2880.781988
#&gt; EXTENSION        191 2880.818013 2880.720303
#&gt; EXTENSION        193 2880.795624 2880.670354
#&gt; LO-REDUCTION     195 2880.787343 2880.670354
#&gt; EXTENSION        197 2880.781988 2880.617628
#&gt; EXTENSION        199 2880.720303 2880.439926
#&gt; LO-REDUCTION     201 2880.680023 2880.439926
#&gt; EXTENSION        203 2880.670354 2880.358120
#&gt; EXTENSION        205 2880.617628 2880.277481
#&gt; EXTENSION        207 2880.473779 2879.924264
#&gt; LO-REDUCTION     209 2880.439926 2879.924264
#&gt; LO-REDUCTION     211 2880.358120 2879.924264
#&gt; LO-REDUCTION     213 2880.277481 2879.924264
#&gt; EXTENSION        215 2880.105129 2879.758291
#&gt; EXTENSION        217 2880.090475 2879.608276
#&gt; LO-REDUCTION     219 2879.960968 2879.608276
#&gt; LO-REDUCTION     221 2879.924264 2879.608276
#&gt; HI-REDUCTION     223 2879.758291 2879.608276
#&gt; REFLECTION       225 2879.713263 2879.550139
#&gt; LO-REDUCTION     227 2879.630410 2879.550139
#&gt; EXTENSION        229 2879.610548 2879.511643
#&gt; LO-REDUCTION     231 2879.608276 2879.511643
#&gt; REFLECTION       233 2879.568497 2879.480952
#&gt; LO-REDUCTION     235 2879.550139 2879.480952
#&gt; LO-REDUCTION     237 2879.526502 2879.480952
#&gt; LO-REDUCTION     239 2879.511643 2879.480932
#&gt; REFLECTION       241 2879.492292 2879.478755
#&gt; LO-REDUCTION     243 2879.484230 2879.476099
#&gt; LO-REDUCTION     245 2879.480952 2879.475526
#&gt; REFLECTION       247 2879.480932 2879.471443
#&gt; HI-REDUCTION     249 2879.478755 2879.471443
#&gt; HI-REDUCTION     251 2879.476099 2879.471443
#&gt; LO-REDUCTION     253 2879.475526 2879.471441
#&gt; LO-REDUCTION     255 2879.473131 2879.470985
#&gt; LO-REDUCTION     257 2879.472498 2879.470985
#&gt; HI-REDUCTION     259 2879.471443 2879.470914
#&gt; HI-REDUCTION     261 2879.471441 2879.470638
#&gt; REFLECTION       263 2879.471127 2879.470444
#&gt; HI-REDUCTION     265 2879.470985 2879.470444
#&gt; HI-REDUCTION     267 2879.470914 2879.470444
#&gt; HI-REDUCTION     269 2879.470638 2879.470444
#&gt; REFLECTION       271 2879.470543 2879.470242
#&gt; LO-REDUCTION     273 2879.470526 2879.470242
#&gt; EXTENSION        275 2879.470450 2879.470087
#&gt; LO-REDUCTION     277 2879.470444 2879.470087
#&gt; LO-REDUCTION     279 2879.470311 2879.470087
#&gt; LO-REDUCTION     281 2879.470242 2879.470087
#&gt; REFLECTION       283 2879.470158 2879.470001
#&gt; HI-REDUCTION     285 2879.470109 2879.470001
#&gt; LO-REDUCTION     287 2879.470101 2879.470001
#&gt; LO-REDUCTION     289 2879.470087 2879.470001
#&gt; Exiting from Nelder Mead minimizer
#&gt;     291 function evaluations used
#&gt; Post processing for method  Nelder-Mead 
#&gt; Successful convergence! 
#&gt; Compute Hessian approximation at finish of  Nelder-Mead 
#&gt; Compute gradient approximation at finish of  Nelder-Mead 
#&gt; Save results from method  Nelder-Mead 
#&gt; $par
#&gt;     log.r log.alpha     log.s  log.beta 
#&gt; -0.238902  1.675864 -1.030490  2.452082 
#&gt; 
#&gt; $value
#&gt; [1] 2879.47
#&gt; 
#&gt; $message
#&gt; NULL
#&gt; 
#&gt; $convcode
#&gt; [1] 0
#&gt; 
#&gt; $fevals
#&gt; function 
#&gt;      291 
#&gt; 
#&gt; $gevals
#&gt; gradient 
#&gt;       NA 
#&gt; 
#&gt; $nitns
#&gt; [1] NA
#&gt; 
#&gt; $kkt1
#&gt; [1] TRUE
#&gt; 
#&gt; $kkt2
#&gt; [1] TRUE
#&gt; 
#&gt; $xtimes
#&gt; user.self 
#&gt;     0.119 
#&gt; 
#&gt; Assemble the answers</div><div class='output co'>#&gt; <span class='message'>Estimation finished!</span></div><div class='input'>
<span class='co'># estimated coefs</span>
<span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span>(<span class='kw'>apparel.pnbd</span>)</div><div class='output co'>#&gt;         r     alpha         s      beta 
#&gt;  0.787492  5.343412  0.356832 11.612502 </div><div class='input'>
<span class='co'># summary of the fitted model</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='kw'>apparel.pnbd</span>)</div><div class='output co'>#&gt; Pareto NBD Standard  Model 
#&gt; 
#&gt; Call:
#&gt; pnbd(clv.data = clv.data.apparel, optimx.args = list(method = "Nelder-Mead", 
#&gt;     control = list(trace = 6)))
#&gt; 
#&gt; Fitting period:                               
#&gt; Estimation start  2005-01-03   
#&gt; Estimation end    2005-10-10   
#&gt; Estimation length 40.0000 Weeks
#&gt; 
#&gt; Coefficients:
#&gt;       Estimate Std. Error z-val Pr(&gt;|z|)    
#&gt; r       0.7875     0.1326 5.941 2.83e-09 ***
#&gt; alpha   5.3434     0.9039 5.912 3.38e-09 ***
#&gt; s       0.3568     0.1833 1.947   0.0515 .  
#&gt; beta   11.6125    10.6334 1.092   0.2748    
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; 
#&gt; Optimization info:                  
#&gt; LL     -2879.4700 
#&gt; AIC    5766.9400  
#&gt; BIC    5781.0258  
#&gt; KKT 1  TRUE       
#&gt; KKT 2  TRUE       
#&gt; fevals 291.0000   
#&gt; Method Nelder-Mead
#&gt; 
#&gt; Used Options:                 
#&gt; Correlation FALSE</div><div class='input'>
<span class='co'># predict CLV etc for holdout period</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='kw'>apparel.pnbd</span>)</div><div class='output co'>#&gt; <span class='message'>Predicting from 2005-10-11 until (incl.) 2006-07-16 (39.86 Weeks).</span></div><div class='output co'>#&gt;        Id period.first period.last period.length actual.x actual.spending
#&gt;   1:    1   2005-10-11  2006-07-16      39.85714        0            0.00
#&gt;   2:   10   2005-10-11  2006-07-16      39.85714        0            0.00
#&gt;   3:  100   2005-10-11  2006-07-16      39.85714       23         5086.44
#&gt;   4: 1000   2005-10-11  2006-07-16      39.85714       23         4077.34
#&gt;   5: 1001   2005-10-11  2006-07-16      39.85714       11         2914.10
#&gt;  ---                                                                     
#&gt; 246: 1219   2005-10-11  2006-07-16      39.85714       14         3233.78
#&gt; 247:  122   2005-10-11  2006-07-16      39.85714        0            0.00
#&gt; 248: 1220   2005-10-11  2006-07-16      39.85714        0            0.00
#&gt; 249: 1221   2005-10-11  2006-07-16      39.85714        9         1322.94
#&gt; 250: 1222   2005-10-11  2006-07-16      39.85714        0            0.00
#&gt;         PAlive        CET       DERT predicted.Spending predicted.CLV
#&gt;   1: 0.3571652  0.2214654 0.05854369           216.7955      12.69201
#&gt;   2: 0.4226928  0.9277460 0.24524673           209.1146      51.28468
#&gt;   3: 0.9156048 13.5446396 3.58048291           188.9758     676.62447
#&gt;   4: 0.9967799 13.1757590 3.48297048           171.0913     595.90582
#&gt;   5: 0.5100298  3.5289953 0.93287881           229.8529     214.42492
#&gt;  ---                                                                 
#&gt; 246: 0.9579466  3.6111037 0.95458391           206.0859     196.72627
#&gt; 247: 0.3571652  0.2214654 0.05854369           216.7955      12.69201
#&gt; 248: 0.3571652  0.2214654 0.05854369           216.7955      12.69201
#&gt; 249: 0.9434610  4.2993712 1.13652527           207.0518     235.31960
#&gt; 250: 0.4137006  0.5822653 0.15391999           208.3194      32.06452</div><div class='input'>
<span class='co'># predict CLV etc for the next 15 periods</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='kw'>apparel.pnbd</span>, prediction.end = <span class='fl'>15</span>)</div><div class='output co'>#&gt; <span class='message'>Predicting from 2005-10-11 until (incl.) 2006-01-23 (15 Weeks).</span></div><div class='output co'>#&gt;        Id period.first period.last period.length actual.x actual.spending
#&gt;   1:    1   2005-10-11  2006-01-23            15        0            0.00
#&gt;   2:   10   2005-10-11  2006-01-23            15        0            0.00
#&gt;   3:  100   2005-10-11  2006-01-23            15       10         1516.83
#&gt;   4: 1000   2005-10-11  2006-01-23            15       10         1980.30
#&gt;   5: 1001   2005-10-11  2006-01-23            15        6         1673.55
#&gt;  ---                                                                     
#&gt; 246: 1219   2005-10-11  2006-01-23            15       11         2256.68
#&gt; 247:  122   2005-10-11  2006-01-23            15        0            0.00
#&gt; 248: 1220   2005-10-11  2006-01-23            15        0            0.00
#&gt; 249: 1221   2005-10-11  2006-01-23            15        7         1180.04
#&gt; 250: 1222   2005-10-11  2006-01-23            15        0            0.00
#&gt;         PAlive        CET       DERT predicted.Spending predicted.CLV
#&gt;   1: 0.3571652 0.08876335 0.05854369           216.7955      12.69201
#&gt;   2: 0.4226928 0.37184063 0.24524673           209.1146      51.28468
#&gt;   3: 0.9156048 5.42869219 3.58048291           188.9758     676.62447
#&gt;   4: 0.9967799 5.28084482 3.48297048           171.0913     595.90582
#&gt;   5: 0.5100298 1.41442148 0.93287881           229.8529     214.42492
#&gt;  ---                                                                 
#&gt; 246: 0.9579466 1.44733052 0.95458391           206.0859     196.72627
#&gt; 247: 0.3571652 0.08876335 0.05854369           216.7955      12.69201
#&gt; 248: 0.3571652 0.08876335 0.05854369           216.7955      12.69201
#&gt; 249: 0.9434610 1.72318818 1.13652527           207.0518     235.31960
#&gt; 250: 0.4137006 0.23337194 0.15391999           208.3194      32.06452</div><div class='input'><span class='co'># }</span>
<span class='co'># \donttest{</span>
<span class='co'># Estimate correlation as well</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(<span class='kw'>clv.data.apparel</span>, use.cor = <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; <span class='message'>Starting estimation...</span></div><div class='output co'>#&gt; <span class='message'>Estimation finished!</span></div><div class='output co'>#&gt; Pareto NBD Standard  Model
#&gt; 
#&gt; Call:
#&gt; pnbd(clv.data = clv.data.apparel, use.cor = TRUE)
#&gt; 
#&gt; Coefficients:
#&gt;               r            alpha                s             beta  
#&gt;        0.790394         5.355977         0.278047         7.116957  
#&gt; Cor(life,trans)  
#&gt;       -0.009087  
#&gt; KKT1: TRUE 
#&gt; KKT2: FALSE 
#&gt; 
#&gt; Used Options:
#&gt; Correlation:     TRUE </div><div class='input'><span class='co'># }</span>
<span class='co'># \donttest{</span>
<span class='co'># To estimate the pnbd model with static covariates,</span>
<span class='co'>#   add static covariates to the data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"apparelStaticCov"</span>)
<span class='kw'>clv.data.static.cov</span> <span class='op'>&lt;-</span>
 <span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/SetStaticCovariates.html'>SetStaticCovariates</a></span>(<span class='kw'>clv.data.apparel</span>,
                     data.cov.life = <span class='kw'>apparelStaticCov</span>,
                     names.cov.life = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Gender"</span>, <span class='st'>"Channel"</span>),
                     data.cov.trans = <span class='kw'>apparelStaticCov</span>,
                     names.cov.trans = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Gender"</span>, <span class='st'>"Channel"</span>))

<span class='co'># Fit pnbd with static covariates</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(<span class='kw'>clv.data.static.cov</span>)</div><div class='output co'>#&gt; <span class='message'>Starting estimation...</span></div><div class='output co'>#&gt; <span class='message'>Estimation finished!</span></div><div class='output co'>#&gt; Pareto NBD with Static Covariates  Model
#&gt; 
#&gt; Call:
#&gt; pnbd(clv.data = clv.data.static.cov)
#&gt; 
#&gt; Coefficients:
#&gt;             r          alpha              s           beta    life.Gender  
#&gt;        1.4187        35.5931         0.2726         8.5451         1.5216  
#&gt;  life.Channel   trans.Gender  trans.Channel  
#&gt;       -1.7034         1.4222         0.4023  
#&gt; KKT1: TRUE 
#&gt; KKT2: TRUE 
#&gt; 
#&gt; Used Options:
#&gt; Correlation:     FALSE 
#&gt; Constraints:     FALSE 
#&gt; Regularization:  FALSE </div><div class='input'>
<span class='co'># Give initial guesses for both covariate parameters</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(<span class='kw'>clv.data.static.cov</span>, start.params.trans = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(Gender=<span class='fl'>0.75</span>, Channel=<span class='fl'>0.7</span>),
                   start.params.life  = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(Gender=<span class='fl'>0.5</span>, Channel=<span class='fl'>0.5</span>))</div><div class='output co'>#&gt; <span class='message'>Starting estimation...</span></div><div class='output co'>#&gt; <span class='message'>Estimation finished!</span></div><div class='output co'>#&gt; Pareto NBD with Static Covariates  Model
#&gt; 
#&gt; Call:
#&gt; pnbd(clv.data = clv.data.static.cov, start.params.life = c(Gender = 0.5, 
#&gt;     Channel = 0.5), start.params.trans = c(Gender = 0.75, Channel = 0.7))
#&gt; 
#&gt; Coefficients:
#&gt;             r          alpha              s           beta    life.Gender  
#&gt;        1.4187        35.6150         0.2731         8.5896         1.5221  
#&gt;  life.Channel   trans.Gender  trans.Channel  
#&gt;       -1.7012         1.4228         0.4024  
#&gt; KKT1: TRUE 
#&gt; KKT2: TRUE 
#&gt; 
#&gt; Used Options:
#&gt; Correlation:     FALSE 
#&gt; Constraints:     FALSE 
#&gt; Regularization:  FALSE </div><div class='input'>
<span class='co'># Use regularization</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(<span class='kw'>clv.data.static.cov</span>, reg.lambdas = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(trans = <span class='fl'>5</span>, life=<span class='fl'>5</span>))</div><div class='output co'>#&gt; <span class='message'>Starting estimation...</span></div><div class='output co'>#&gt; <span class='message'>Estimation finished!</span></div><div class='output co'>#&gt; Pareto NBD with Static Covariates  Model
#&gt; 
#&gt; Call:
#&gt; pnbd(clv.data = clv.data.static.cov, reg.lambdas = c(trans = 5, 
#&gt;     life = 5))
#&gt; 
#&gt; Coefficients:
#&gt;             r          alpha              s           beta    life.Gender  
#&gt;     0.7918760      5.4432020      0.3582027     11.6263432     -0.0004814  
#&gt;  life.Channel   trans.Gender  trans.Channel  
#&gt;    -0.0023693      0.0106766      0.0087496  
#&gt; KKT1: TRUE 
#&gt; KKT2: TRUE 
#&gt; 
#&gt; Used Options:
#&gt; Correlation:     FALSE 
#&gt; Constraints:     FALSE 
#&gt; Regularization:  TRUE </div><div class='input'>
<span class='co'># Force the same coefficient to be used for both covariates</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(<span class='kw'>clv.data.static.cov</span>, names.cov.constr = <span class='st'>"Gender"</span>,
                   start.params.constr = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(Gender=<span class='fl'>0.5</span>))</div><div class='output co'>#&gt; <span class='message'>Starting estimation...</span></div><div class='output co'>#&gt; <span class='message'>Estimation finished!</span></div><div class='output co'>#&gt; Pareto NBD with Static Covariates  Model
#&gt; 
#&gt; Call:
#&gt; pnbd(clv.data = clv.data.static.cov, names.cov.constr = "Gender", 
#&gt;     start.params.constr = c(Gender = 0.5))
#&gt; 
#&gt; Coefficients:
#&gt;             r          alpha              s           beta   life.Channel  
#&gt;        1.4236        35.4670         0.2740         7.8680        -1.6889  
#&gt; trans.Channel  constr.Gender  
#&gt;        0.4018         1.4160  
#&gt; KKT1: TRUE 
#&gt; KKT2: TRUE 
#&gt; 
#&gt; Used Options:
#&gt; Correlation:     FALSE 
#&gt; Constraints:     TRUE 
#&gt; Regularization:  FALSE </div><div class='input'>
<span class='co'># Fit model only with the Channel covariate for life but</span>
<span class='co'># keep all trans covariates as is</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(<span class='kw'>clv.data.static.cov</span>, names.cov.life = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Channel"</span>))</div><div class='output co'>#&gt; <span class='message'>Starting estimation...</span></div><div class='output co'>#&gt; <span class='message'>Estimation finished!</span></div><div class='output co'>#&gt; Pareto NBD with Static Covariates  Model
#&gt; 
#&gt; Call:
#&gt; pnbd(clv.data = clv.data.static.cov, names.cov.life = c("Channel"))
#&gt; 
#&gt; Coefficients:
#&gt;             r          alpha              s           beta   life.Channel  
#&gt;        1.4912        32.1394         0.2497         1.8006        -1.6940  
#&gt;  trans.Gender  trans.Channel  
#&gt;        1.2721         0.3936  
#&gt; KKT1: TRUE 
#&gt; KKT2: TRUE 
#&gt; 
#&gt; Used Options:
#&gt; Correlation:     FALSE 
#&gt; Constraints:     FALSE 
#&gt; Regularization:  FALSE </div><div class='input'><span class='co'># }</span>
<span class='co'># Add dynamic covariates data to the data object</span>
<span class='co'>#   add dynamic covariates to the data</span>
<span class='co'># \donttest{</span>
<span class='co'>if</span> (<span class='fl'>FALSE</span>) {
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"apparelDynCov"</span>)
<span class='kw'>clv.data.dyn.cov</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/SetDynamicCovariates.html'>SetDynamicCovariates</a></span>(clv.data = <span class='kw'>clv.data.apparel</span>,
                       data.cov.life = <span class='kw'>apparelDynCov</span>,
                       data.cov.trans = <span class='kw'>apparelDynCov</span>,
                       names.cov.life = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Marketing"</span>, <span class='st'>"Gender"</span>, <span class='st'>"Channel"</span>),
                       names.cov.trans = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Marketing"</span>, <span class='st'>"Gender"</span>, <span class='st'>"Channel"</span>),
                       name.date = <span class='st'>"Cov.Date"</span>)

<span class='co'># Enable parallel execution of some parts of the dyncov LL</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='kw'><a href='https://github.com/HenrikBengtsson/doFuture'>doFuture</a></span>)
<span class='fu'><a href='https://rdrr.io/pkg/doFuture/man/registerDoFuture.html'>registerDoFuture</a></span>()
<span class='co'># avoid overhead from nested parallelism by setting up</span>
<span class='co'># appropriate to _your_ system</span>
<span class='fu'>setDTthreads</span>(threads=<span class='fl'>8</span>)
<span class='fu'>plan</span>(<span class='st'>"multisession"</span>, workers=<span class='fl'>2</span>)

<span class='co'># Fit PNBD with dynamic covariates</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(<span class='kw'>clv.data.dyn.cov</span>)

<span class='co'># The same fitting options as for the</span>
<span class='co'>#  static covariate are available</span>
<span class='fu'><a href='https://rdrr.io/pkg/CLVTools/man/pnbd.html'>pnbd</a></span>(<span class='kw'>clv.data.dyn.cov</span>, reg.lambdas = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(trans=<span class='fl'>10</span>, life=<span class='fl'>2</span>))
}
<span class='co'># }</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Patrick Bachmann, Jeffrey Naef, Patrik Schilter, Markus Meierer, Niels Kuebler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


