<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create an object for transactional data required to estimate CLV — clvdata • CLVTools</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create an object for transactional data required to estimate CLV — clvdata"><meta property="og:description" content="Creates a data object that contains the prepared transaction data and that is used as input for
model fitting. The transaction data may be split in an estimation and holdout sample if desired.
The model then will only be fit on the estimation sample.
If covariates should be used when fitting a model, covariate data can be added
to an object returned from this function."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-31477052-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-31477052-2');
</script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CLVTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.11.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/CLVTools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/internal_docu/internal_docu.html">Internal Package Documentation</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/bachmannpatrick/CLVTools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create an object for transactional data required to estimate CLV</h1>
    <small class="dont-index">Source: <a href="https://github.com/bachmannpatrick/CLVTools/blob/master/R/f_interface_clvdata.R" class="external-link"><code>R/f_interface_clvdata.R</code></a></small>
    <div class="hidden name"><code>clvdata.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Creates a data object that contains the prepared transaction data and that is used as input for
model fitting. The transaction data may be split in an estimation and holdout sample if desired.
The model then will only be fit on the estimation sample.</p>
<p>If covariates should be used when fitting a model, covariate data can be added
to an object returned from this function.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">clvdata</span><span class="op">(</span></span>
<span>  <span class="va">data.transactions</span>,</span>
<span>  <span class="va">date.format</span>,</span>
<span>  <span class="va">time.unit</span>,</span>
<span>  estimation.split <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  name.id <span class="op">=</span> <span class="st">"Id"</span>,</span>
<span>  name.date <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>  name.price <span class="op">=</span> <span class="st">"Price"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-data-transactions">data.transactions<a class="anchor" aria-label="anchor" href="#arg-data-transactions"></a></dt>
<dd><p>Transaction data as <code>data.frame</code> or <code>data.table</code>. See details.</p></dd>


<dt id="arg-date-format">date.format<a class="anchor" aria-label="anchor" href="#arg-date-format"></a></dt>
<dd><p>Character string that indicates the format of the date variable in the data used. See details.</p></dd>


<dt id="arg-time-unit">time.unit<a class="anchor" aria-label="anchor" href="#arg-time-unit"></a></dt>
<dd><p>What time unit defines a period. May be abbreviated, capitalization is ignored. See details.</p></dd>


<dt id="arg-estimation-split">estimation.split<a class="anchor" aria-label="anchor" href="#arg-estimation-split"></a></dt>
<dd><p>Indicates the length of the estimation period. See details.</p></dd>


<dt id="arg-name-id">name.id<a class="anchor" aria-label="anchor" href="#arg-name-id"></a></dt>
<dd><p>Column name of the customer id in <code>data.transactions</code>.</p></dd>


<dt id="arg-name-date">name.date<a class="anchor" aria-label="anchor" href="#arg-name-date"></a></dt>
<dd><p>Column name of the transaction date in <code>data.transactions</code>.</p></dd>


<dt id="arg-name-price">name.price<a class="anchor" aria-label="anchor" href="#arg-name-price"></a></dt>
<dd><p>Column name of price in <code>data.transactions</code>. NULL if no spending data is present.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An object of class <code>clv.data</code>.
See the class definition <a href="clv.data-class.html">clv.data</a>
for more details about the returned object.</p>
<p>The function <code>summary</code> can be used to obtain and print a summary of the data.
The generic accessor function <code>nobs</code> is available to read out the number of customers.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><code>data.transactions</code> A <code>data.frame</code> or <code>data.table</code> with customers' purchase history.
Every transaction record consists of a purchase date and a customer id.
Optionally, the price of the transaction may be included to also allow for prediction
of future customer spending.</p>
<p><code>time.unit</code> The definition of a single period. Currently available are <code>"hours"</code>, <code>"days"</code>, <code>"weeks"</code>, and <code>"years"</code>.
May be abbreviated.</p>
<p><code>date.format</code> A single format to use when parsing any date that is given as character input. This includes
the dates given in <code>data.transaction</code>, <code>estimation.split</code>, or as an input to any other function at
a later point, such as <code>prediction.end</code> in <code>predict</code>.
The function <code><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html" class="external-link">parse_date_time</a></code> of package <code>lubridate</code> is used to parse inputs
and hence all formats it accepts in argument <code>orders</code> can be used. For example, a date of format "year-month-day"
(i.e., "2010-06-17") is indicated with <code>"ymd"</code>. Other combinations such as <code>"dmy"</code>, <code>"dym"</code>,
<code>"ymd HMS"</code>, or <code>"HMS dmy"</code> are possible as well.</p>
<p><code>estimation.split</code> May be specified as either the number of periods since the first transaction or the timepoint
(either as character, Date, or POSIXct) at which the estimation period ends. The indicated timepoint itself will be part of the estimation sample.
If no value is provided or set to <code>NULL</code>, the whole dataset will used for fitting the model (no holdout sample).</p>
<div class="section">
<h3 id="aggregation-of-transactions">Aggregation of Transactions<a class="anchor" aria-label="anchor" href="#aggregation-of-transactions"></a></h3>


<p>Multiple transactions by the same customer that occur on the minimally representable temporal resolution are aggregated to a
single transaction with their spending summed. For time units <code>days</code> and any other coarser <code>Date</code>-based
time units (i.e. <code>weeks</code>, <code>years</code>), this means that transactions on the same day are combined.
When using finer time units such as <code>hours</code> which are based on <code>POSIXct</code>, transactions on the same second are aggregated.</p>
<p>For the definition of repeat-purchases, combined transactions are viewed as a single transaction. Hence, repeat-transactions
are determined from the aggregated transactions.</p>
</div>

    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="SetStaticCovariates.html">SetStaticCovariates</a></code> to add static covariates</p>
<p><code><a href="SetDynamicCovariates.html">SetDynamicCovariates</a></code> for how to add dynamic covariates</p>
<p><code><a href="plot.clv.data.html">plot</a></code> to plot the repeat transactions</p>
<p><code><a href="summary.clv.data.html">summary</a></code> to summarize the transaction data</p>
<p><code><a href="pnbd.html">pnbd</a></code> to fit Pareto/NBD models on a <code>clv.data</code> object</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"cdnow"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create clv data object with weekly periods</span></span></span>
<span class="r-in"><span><span class="co">#    and no splitting</span></span></span>
<span class="r-in"><span><span class="va">clv.data.cdnow</span> <span class="op">&lt;-</span> <span class="fu">clvdata</span><span class="op">(</span>data.transactions <span class="op">=</span> <span class="va">cdnow</span>,</span></span>
<span class="r-in"><span>                          date.format<span class="op">=</span><span class="st">"ymd"</span>,</span></span>
<span class="r-in"><span>                          time.unit <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># same but split after 37 periods</span></span></span>
<span class="r-in"><span><span class="va">clv.data.cdnow</span> <span class="op">&lt;-</span> <span class="fu">clvdata</span><span class="op">(</span>data.transactions <span class="op">=</span> <span class="va">cdnow</span>,</span></span>
<span class="r-in"><span>                          date.format<span class="op">=</span><span class="st">"ymd"</span>,</span></span>
<span class="r-in"><span>                          time.unit <span class="op">=</span> <span class="st">"w"</span>,</span></span>
<span class="r-in"><span>                          estimation.split <span class="op">=</span> <span class="fl">37</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># same but estimation end on the 15th Oct 1997</span></span></span>
<span class="r-in"><span><span class="va">clv.data.cdnow</span> <span class="op">&lt;-</span> <span class="fu">clvdata</span><span class="op">(</span>data.transactions <span class="op">=</span> <span class="va">cdnow</span>,</span></span>
<span class="r-in"><span>                          date.format<span class="op">=</span><span class="st">"ymd"</span>,</span></span>
<span class="r-in"><span>                          time.unit <span class="op">=</span> <span class="st">"w"</span>,</span></span>
<span class="r-in"><span>                          estimation.split <span class="op">=</span> <span class="st">"1997-10-15"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># summary of the transaction data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">clv.data.cdnow</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CLV Transaction Data </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time unit         Weeks         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation length 41.0000 Weeks </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Holdout length    36.71429 Weeks</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Transaction Data Summary </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                    Estimation      Holdout         Total     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of customers                -               -               2357      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> First Transaction in period        1997-01-01      1997-10-16      1997-01-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Last Transaction in period         1997-10-15      1998-06-30      1998-06-30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total # Transactions               4926            1770            6696      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mean # Transactions per cust       2.090           2.674           2.841     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (SD)                               2.275           2.892           3.772     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mean Spending per Transaction      35.917          37.946          36.453    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (SD)                               43.314          33.838          41.030    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total Spending                     176928.390      67163.550       244091.940</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total # zero repeaters             1392            -               -         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percentage of zero repeaters       59.058          -               -         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mean Interpurchase time            9.738           7.996           16.017    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (SD)                               8.250           6.185           14.533    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot the total number of transactions per period</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.clv.fitted.transactions.html">plot</a></span><span class="op">(</span><span class="va">clv.data.cdnow</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Plotting from 1997-01-01 until 1998-07-05.</span>
<span class="r-plt img"><img src="clvdata-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># create data with the weekly periods defined to</span></span></span>
<span class="r-in"><span><span class="co">#   start on Mondays</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set start of week to Monday</span></span></span>
<span class="r-in"><span><span class="va">oldopts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"lubridate.week.start"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create clv.data while Monday is the beginning of the week</span></span></span>
<span class="r-in"><span><span class="va">clv.data.cdnow</span> <span class="op">&lt;-</span> <span class="fu">clvdata</span><span class="op">(</span>data.transactions <span class="op">=</span> <span class="va">cdnow</span>,</span></span>
<span class="r-in"><span>                          date.format<span class="op">=</span><span class="st">"ymd"</span>,</span></span>
<span class="r-in"><span>                          time.unit <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Dynamic covariates now have to be supplied for every Monday</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set week start to what it was before</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">oldopts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Patrick Bachmann, Niels Kuebler, Markus Meierer, Jeffrey Naef, E. Shin Oblander, Patrik Schilter.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer></div>






  </body></html>

