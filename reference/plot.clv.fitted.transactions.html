<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Plot Diagnostics for a Fitted Transaction Model — plot.clv.fitted.transactions • CLVTools</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Plot Diagnostics for a Fitted Transaction Model — plot.clv.fitted.transactions"><meta property="og:description" content="Depending on the value of parameter which, one of the following plots will be produced.
See plot.clv.data to plot more nuanced diagnostics for the transaction data only.
For comparison, other models can be drawn into the same plot by specifying them in other.models (see examples).


Tracking Plot
Plot the actual repeat transactions and overlay it with the repeat transaction as predicted
by the fitted model. Currently, following previous literature, the in-sample unconditional
expectation is plotted in the holdout period. In the future, we might add the option to also
plot the summed CET for the holdout period as an alternative evaluation metric.
Note that only whole periods can be plotted and that the prediction end might not exactly match prediction.end.
See the Note section for more details.



PMF Plot
Plot the actual and expected number of customers which made a given number of repeat
transaction in the estimation period. The expected number is based on the PMF of the fitted model,
the probability to make exactly a given number of repeat transactions in the estimation period.
For each bin, the expected number is the sum of all customers' individual PMF value.
Note that if trans.bins is changed, label.remaining needs to be adapted as well.

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-31477052-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-31477052-2');
</script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CLVTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.12.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/CLVTools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/bachmannpatrick/CLVTools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Plot Diagnostics for a Fitted Transaction Model</h1>
    <small class="dont-index">Source: <a href="https://github.com/bachmannpatrick/CLVTools/blob/master/R/f_s3generics_clvfittedtransactions_plot.R" class="external-link"><code>R/f_s3generics_clvfittedtransactions_plot.R</code></a></small>
    <div class="hidden name"><code>plot.clv.fitted.transactions.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Depending on the value of parameter <code>which</code>, one of the following plots will be produced.
See <code><a href="plot.clv.data.html">plot.clv.data</a></code> to plot more nuanced diagnostics for the transaction data only.
For comparison, other models can be drawn into the same plot by specifying them in <code>other.models</code> (see examples).</p>

<div class="section">
<h3 id="tracking-plot">Tracking Plot<a class="anchor" aria-label="anchor" href="#tracking-plot"></a></h3>
<p>Plot the actual repeat transactions and overlay it with the repeat transaction as predicted
by the fitted model. Currently, following previous literature, the in-sample unconditional
expectation is plotted in the holdout period. In the future, we might add the option to also
plot the summed CET for the holdout period as an alternative evaluation metric.
Note that only whole periods can be plotted and that the prediction end might not exactly match <code>prediction.end</code>.
See the Note section for more details.</p>
</div>

<div class="section">
<h3 id="pmf-plot">PMF Plot<a class="anchor" aria-label="anchor" href="#pmf-plot"></a></h3>
<p>Plot the actual and expected number of customers which made a given number of repeat
transaction in the estimation period. The expected number is based on the PMF of the fitted model,
the probability to make exactly a given number of repeat transactions in the estimation period.
For each bin, the expected number is the sum of all customers' individual PMF value.
Note that if <code>trans.bins</code> is changed, <code>label.remaining</code> needs to be adapted as well.</p>
</div>

    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'clv.fitted.transactions'</span></span>
<span><span class="fu">plot</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tracking"</span>, <span class="st">"pmf"</span><span class="op">)</span>,</span>
<span>  other.models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prediction.end <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cumulative <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  trans.bins <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">9</span>,</span>
<span>  calculate.remaining <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  label.remaining <span class="op">=</span> <span class="st">"10+"</span>,</span>
<span>  newdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transactions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'clv.fitted.transactions'</span></span>
<span><span class="fu">plot</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tracking"</span>, <span class="st">"pmf"</span><span class="op">)</span>,</span>
<span>  other.models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prediction.end <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cumulative <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  trans.bins <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">9</span>,</span>
<span>  calculate.remaining <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  label.remaining <span class="op">=</span> <span class="st">"10+"</span>,</span>
<span>  newdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transactions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>The fitted transaction model for which to produce diagnostic plots</p></dd>


<dt id="arg-which">which<a class="anchor" aria-label="anchor" href="#arg-which"></a></dt>
<dd><p>Which plot to produce, either "tracking" or "pmf". May be abbreviated but only one may be selected. Defaults to "tracking".</p></dd>


<dt id="arg-other-models">other.models<a class="anchor" aria-label="anchor" href="#arg-other-models"></a></dt>
<dd><p>List of fitted transaction models to plot. List names are used as colors, standard colors are chosen if unnamed (see examples).
The <code>clv.data</code> object stored in each model is used if no <code>newdata</code> is given.</p></dd>


<dt id="arg-prediction-end">prediction.end<a class="anchor" aria-label="anchor" href="#arg-prediction-end"></a></dt>
<dd><p>"tracking": Until what point in time to plot. This can be the number of periods (numeric) or a form of date/time object. See details.</p></dd>


<dt id="arg-cumulative">cumulative<a class="anchor" aria-label="anchor" href="#arg-cumulative"></a></dt>
<dd><p>"tracking": Whether the cumulative expected (and actual) transactions should be plotted.</p></dd>


<dt id="arg-trans-bins">trans.bins<a class="anchor" aria-label="anchor" href="#arg-trans-bins"></a></dt>
<dd><p>"pmf": Vector of positive integer numbers (&gt;=0) indicating the number of repeat transactions (x axis) to plot. Should contain 0 in nearly all cases as it refers to repeat-transactions.</p></dd>


<dt id="arg-calculate-remaining">calculate.remaining<a class="anchor" aria-label="anchor" href="#arg-calculate-remaining"></a></dt>
<dd><p>"pmf": Whether the probability for the remaining number of transactions not in <code>trans.bins</code> should be calculated.</p></dd>


<dt id="arg-label-remaining">label.remaining<a class="anchor" aria-label="anchor" href="#arg-label-remaining"></a></dt>
<dd><p>"pmf": Label for the last bar, if <code>calculate.remaining=TRUE</code>.</p></dd>


<dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p>An object of class clv.data for which the plotting should be made with the fitted model.
If none or NULL is given, the plot is made for the data on which the model was fit.
If <code>other.models</code> was specified, the data in each model is replaced with <code>newdata</code>.</p></dd>


<dt id="arg-transactions">transactions<a class="anchor" aria-label="anchor" href="#arg-transactions"></a></dt>
<dd><p>Whether the actual observed repeat transactions should be plotted.</p></dd>


<dt id="arg-label">label<a class="anchor" aria-label="anchor" href="#arg-label"></a></dt>
<dd><p>Character vector to label each model. If NULL, the model(s) internal name is used (see examples).</p></dd>


<dt id="arg-plot">plot<a class="anchor" aria-label="anchor" href="#arg-plot"></a></dt>
<dd><p>Whether a plot is created or only the assembled data is returned.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Show details about the running of the function.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Ignored</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An object of class <code>ggplot</code> from package <code>ggplot2</code> is returned by default.
If <code>plot=FALSE</code>, the data that would have been used to create the plot is returned.
Depending on which plot was selected, this is a data.table which contains the
following columns:</p>
<p>For the Tracking plot:</p>
<dl><dt>period.until</dt>
<dd><p>The timepoint that marks the end (up until and including) of the period to which the data in this row refers.</p></dd>

<dt>variable</dt>
<dd><p>Type of variable that 'value' refers to. Either "model name" or "Actual" (if <code>transactions=TRUE</code>).</p></dd>

<dt>value</dt>
<dd><p>Depending on variable either (Actual) the actual number of repeat transactions in the period that ends at <code>period.until</code>,
or the unconditional expectation for the period that ends on <code>period.until</code> ("model name"). Actuals may be <code>NA</code> if no transaction was recorded.</p></dd>


</dl><p>For the PMF plot:</p>
<dl><dt>num.transactions</dt>
<dd><p>The number of repeat transactions in the estimation period (as ordered factor).</p></dd>

<dt>variable</dt>
<dd><p>Type of variable that 'value' refers to. Either "model name" or "Actual" (if <code>transactions=TRUE</code>).</p></dd>

<dt>value</dt>
<dd><p>Depending on variable either (Actual) the actual number of customers which have the respective number of repeat transactions,
or the number of customers which are expected to have the respective number of repeat transactions, as by the fitted model ("model name").</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p><code>prediction.end</code> indicates until when to predict or plot and can be given as either
a point in time (of class <code>Date</code>, <code>POSIXct</code>, or <code>character</code>) or the number of periods.
If <code>prediction.end</code> is of class character, the date/time format set when creating the data object is used for parsing.
If <code>prediction.end</code> is the number of periods, the end of the fitting period serves as the reference point
from which periods are counted. Only full periods may be specified.
If <code>prediction.end</code> is omitted or NULL, it defaults to the end of the holdout period if present and to the
end of the estimation period otherwise.</p>
<p>The first prediction period is defined to start right after the end of the estimation period.
If for example weekly time units are used and the estimation period ends on Sunday 2019-01-01, then the first day
of the first prediction period is Monday 2019-01-02. Each prediction period includes a total of 7 days and
the first prediction period therefore will end on, and include, Sunday 2019-01-08. Subsequent prediction periods
again start on Mondays and end on Sundays.
If <code>prediction.end</code> indicates a timepoint on which to end, this timepoint is included in the prediction period.</p>
<p>The <code>newdata</code> argument has to be a clv data object of the exact same class as the data object
on which the model was fit. In case the model was fit with covariates, <code>newdata</code> needs to contain identically
named covariate data.</p>
<p>The use case for <code>newdata</code> is mainly two-fold: First, to estimate model parameters only on a
sample of the data and then use the fitted model object to predict or plot for the full data set provided through <code>newdata</code>.
Second, for models with dynamic covariates, to provide a clv data object with longer covariates than contained in the data
on which the model was estimated what allows to predict or plot further. When providing <code>newdata</code>, some models
might require additional steps that can significantly increase runtime.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>Because the unconditional expectation for a period is derived as the difference of
the cumulative expectations calculated at the beginning and at end of the period,
all timepoints for which the expectation is calculated are required to be spaced exactly 1 time unit apart.</p>
<p>If <code>prediction.end</code> does not coincide with the start of a time unit, the last timepoint
for which the expectation is calculated and plotted therefore is not <code>prediction.end</code>
but the start of the first time unit after <code>prediction.end</code>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="plot.clv.fitted.spending.html">plot.clv.fitted.spending</a></code> for diagnostics of spending models</p>
<p><code><a href="plot.clv.data.html">plot.clv.data</a></code> for transaction diagnostics of <code>clv.data</code> objects</p>
<p><code><a href="pmf.html">pmf</a></code> for the values on which the PMF plot is based</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"cdnow"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit ParetoNBD model on the CDnow data</span></span></span>
<span class="r-in"><span><span class="va">clv.cdnow</span> <span class="op">&lt;-</span> <span class="fu"><a href="clvdata.html">clvdata</a></span><span class="op">(</span><span class="va">cdnow</span>, time.unit<span class="op">=</span><span class="st">"w"</span>,</span></span>
<span class="r-in"><span>                           estimation.split<span class="op">=</span><span class="fl">37</span>,</span></span>
<span class="r-in"><span>                           date.format<span class="op">=</span><span class="st">"ymd"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pnbd.cdnow</span> <span class="op">&lt;-</span> <span class="fu"><a href="pnbd.html">pnbd</a></span><span class="op">(</span><span class="va">clv.cdnow</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting estimation...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimation finished!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## TRACKING PLOT</span></span></span>
<span class="r-in"><span><span class="co"># Plot actual repeat transaction, overlayed with the</span></span></span>
<span class="r-in"><span><span class="co">#  expected repeat transactions as by the fitted model</span></span></span>
<span class="r-in"><span><span class="fu">plot</span><span class="op">(</span><span class="va">pnbd.cdnow</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Plotting from 1997-01-01 until 1998-07-05.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>A <span style="color: #0000BB;">&lt;numeric&gt;</span> value was passed to a <span style="color: #00BB00;">Date</span> scale.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The value was converted to a &lt;Date&gt; object.</span>
<span class="r-plt img"><img src="plot.clv.fitted.transactions-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot cumulative expected transactions of only the model</span></span></span>
<span class="r-in"><span><span class="fu">plot</span><span class="op">(</span><span class="va">pnbd.cdnow</span>, cumulative<span class="op">=</span><span class="cn">TRUE</span>, transactions<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Plotting from 1997-01-01 until 1998-07-05.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>A <span style="color: #0000BB;">&lt;numeric&gt;</span> value was passed to a <span style="color: #00BB00;">Date</span> scale.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The value was converted to a &lt;Date&gt; object.</span>
<span class="r-plt img"><img src="plot.clv.fitted.transactions-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot until 2001-10-21</span></span></span>
<span class="r-in"><span><span class="fu">plot</span><span class="op">(</span><span class="va">pnbd.cdnow</span>, prediction.end <span class="op">=</span> <span class="st">"2001-10-21"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Plotting from 1997-01-01 until 2001-10-21.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>A <span style="color: #0000BB;">&lt;numeric&gt;</span> value was passed to a <span style="color: #00BB00;">Date</span> scale.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The value was converted to a &lt;Date&gt; object.</span>
<span class="r-plt img"><img src="plot.clv.fitted.transactions-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot until 2001-10-21, as date</span></span></span>
<span class="r-in"><span><span class="fu">plot</span><span class="op">(</span><span class="va">pnbd.cdnow</span>,</span></span>
<span class="r-in"><span>     prediction.end <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">dym</a></span><span class="op">(</span><span class="st">"21-2001-10"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Plotting from 1997-01-01 until 2001-10-21.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>A <span style="color: #0000BB;">&lt;numeric&gt;</span> value was passed to a <span style="color: #00BB00;">Date</span> scale.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The value was converted to a &lt;Date&gt; object.</span>
<span class="r-plt img"><img src="plot.clv.fitted.transactions-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot 15 time units after end of estimation period</span></span></span>
<span class="r-in"><span><span class="fu">plot</span><span class="op">(</span><span class="va">pnbd.cdnow</span>, prediction.end <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Plotting from 1997-01-01 until 1998-01-04.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Not plotting full holdout period.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>A <span style="color: #0000BB;">&lt;numeric&gt;</span> value was passed to a <span style="color: #00BB00;">Date</span> scale.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The value was converted to a &lt;Date&gt; object.</span>
<span class="r-plt img"><img src="plot.clv.fitted.transactions-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Save the data generated for plotting</span></span></span>
<span class="r-in"><span><span class="co">#   (period, actual transactions, expected transactions)</span></span></span>
<span class="r-in"><span><span class="va">plot.out</span> <span class="op">&lt;-</span> <span class="fu">plot</span><span class="op">(</span><span class="va">pnbd.cdnow</span>, prediction.end <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Plotting from 1997-01-01 until 1998-01-04.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Not plotting full holdout period.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A ggplot object is returned that can be further tweaked</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gg.pnbd.cdnow</span> <span class="op">&lt;-</span> <span class="fu">plot</span><span class="op">(</span><span class="va">pnbd.cdnow</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Plotting from 1997-01-01 until 1998-07-05.</span>
<span class="r-in"><span><span class="va">gg.pnbd.cdnow</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"PNBD on CDnow"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>A <span style="color: #0000BB;">&lt;numeric&gt;</span> value was passed to a <span style="color: #00BB00;">Date</span> scale.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The value was converted to a &lt;Date&gt; object.</span>
<span class="r-plt img"><img src="plot.clv.fitted.transactions-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## PMF PLOT</span></span></span>
<span class="r-in"><span><span class="fu">plot</span><span class="op">(</span><span class="va">pnbd.cdnow</span>, which<span class="op">=</span><span class="st">"pmf"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.clv.fitted.transactions-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For transactions 0 to 15, also have</span></span></span>
<span class="r-in"><span><span class="co">#  to change label for remaining</span></span></span>
<span class="r-in"><span><span class="fu">plot</span><span class="op">(</span><span class="va">pnbd.cdnow</span>, which<span class="op">=</span><span class="st">"pmf"</span>, trans.bins<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">15</span>,</span></span>
<span class="r-in"><span>     label.remaining<span class="op">=</span><span class="st">"16+"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.clv.fitted.transactions-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For transactions 0 to 15 bins, no remaining</span></span></span>
<span class="r-in"><span><span class="fu">plot</span><span class="op">(</span><span class="va">pnbd.cdnow</span>, which<span class="op">=</span><span class="st">"pmf"</span>, trans.bins<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">15</span>,</span></span>
<span class="r-in"><span>     calculate.remaining<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.clv.fitted.transactions-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## MODEL COMPARISON</span></span></span>
<span class="r-in"><span><span class="co"># compare vs bgnbd</span></span></span>
<span class="r-in"><span><span class="va">bgnbd.cdnow</span> <span class="op">&lt;-</span> <span class="fu"><a href="bgnbd.html">bgnbd</a></span><span class="op">(</span><span class="va">clv.cdnow</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting estimation...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimation finished!</span>
<span class="r-in"><span><span class="va">ggomnbd.cdnow</span> <span class="op">&lt;-</span> <span class="fu"><a href="ggomnbd.html">ggomnbd</a></span><span class="op">(</span><span class="va">clv.cdnow</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting estimation...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimation finished!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># specify colors as names of other.models</span></span></span>
<span class="r-in"><span><span class="co"># note that ggomnbd collapses into the pnbd on this dataset</span></span></span>
<span class="r-in"><span><span class="fu">plot</span><span class="op">(</span><span class="va">pnbd.cdnow</span>, cumulative<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>     other.models<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>blue<span class="op">=</span><span class="va">bgnbd.cdnow</span>, <span class="st">"#00ff00"</span><span class="op">=</span><span class="va">ggomnbd.cdnow</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Collecting data for other models...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Plotting from 1997-01-01 until 1998-07-05.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Plotting from 1997-01-01 until 1998-07-05.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Plotting from 1997-01-01 until 1998-07-05.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>A <span style="color: #0000BB;">&lt;numeric&gt;</span> value was passed to a <span style="color: #00BB00;">Date</span> scale.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The value was converted to a &lt;Date&gt; object.</span>
<span class="r-plt img"><img src="plot.clv.fitted.transactions-10.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># specify names as label, using standard colors</span></span></span>
<span class="r-in"><span><span class="fu">plot</span><span class="op">(</span><span class="va">pnbd.cdnow</span>, which<span class="op">=</span><span class="st">"pmf"</span>,</span></span>
<span class="r-in"><span>     other.models<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">bgnbd.cdnow</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pareto/NBD"</span>, <span class="st">"BG/NBD"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Collecting data for other models...</span>
<span class="r-plt img"><img src="plot.clv.fitted.transactions-11.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Patrick Bachmann, Niels Kuebler, Markus Meierer, Jeffrey Naef, E. Shin Oblander, Patrik Schilter.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

